
  <!DOCTYPE html>
  <html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
    pre {
      border: 1px solid lightgray;
      padding: 10px;
    }
    </style>
  </head>
  <body>
    <h3>\appendix\component-report\build.gradle</h3><pre>/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'nobusue' at '14/09/14 12:53' with Gradle 2.1
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at http://gradle.org/docs/2.1/userguide/tutorial_java_projects.html
 */

plugins {
  id "com.github.tkruse.groovysh" version "1.0.2"
}

// Apply the java plugin to add support for Java
apply plugin: 'java'

// In this section you declare where to find the dependencies of your project
repositories {
    // Use 'jcenter' for resolving your dependencies.
    // You can declare any Maven/Ivy/file repository here.
    jcenter()
}

// In this section you declare the dependencies for your production and test code
dependencies {
    // The production code uses the SLF4J logging API at compile time
    compile 'org.slf4j:slf4j-api:1.7.5'

    // Declare the dependency for your favourite test framework you want to use in your tests.
    // TestNG is also supported by the Gradle Test task. Just change the
    // testCompile dependency to testCompile 'org.testng:testng:6.8.1' and add
    // 'test.useTestNG()' to your build script.
    testCompile 'junit:junit:4.11'
}
</pre><h3>\appendix\component-report\settings.gradle</h3><pre>/*
 * This settings file was auto generated by the Gradle buildInit task
 * by 'nobusue' at '14/09/14 12:53' with Gradle 2.1
 *
 * The settings file is used to specify which projects to include in your build.
 * In a single project build this file can be empty or even removed.
 *
 * Detailed information about configuring a multi-project build in Gradle can be found
 * in the user guide at http://gradle.org/docs/2.1/userguide/multi_project_builds.html
 */

/*
// To declare projects as part of a multi-project build use the 'include' method
include 'shared'
include 'api'
include 'services:webservice'
*/

rootProject.name = 'component-report'
</pre><h3>\chapter03\first-gradle\build.gradle</h3><pre>// (1) hello 태스크 정의
task hello << {
  // (2) 태스크에 추가하는 처리
  println 'Hello Gradle world!'
}
</pre><h3>\chapter03\java-project\build.gradle</h3><pre>/*
 * This build file was auto generated by running the Gradle 'init' task
 * by 'xxxx' at '14/08/03 23:10' with Gradle 2.0
 *
 * This generated file contains a sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at http://gradle.org/docs/2.0/userguide/tutorial_java_projects.html
 */

// Apply the java plugin to add support for Java
apply plugin: 'java'

// In this section you declare where to find the dependencies of your project
repositories {
  // Use 'maven central' for resolving your dependencies.
  // You can declare any Maven/Ivy/file repository here.
  mavenCentral()
}

// In this section you declare the dependencies for your production and test code
dependencies {
  // The production code uses the SLF4J logging API at compile time
  compile 'org.slf4j:slf4j-api:1.7.5'

  // Declare the dependency for your favourite test framework you want to use in your tests.
  // TestNG is also supported by the Gradle Test task. Just change the
  // testCompile dependency to testCompile 'org.testng:testng:6.8.1' and add
  // 'test.useTestNG()' to your build script.
  testCompile 'junit:junit:4.11'
}
</pre><h3>\chapter03\java-project\settings.gradle</h3><pre>/*
 * This settings file was auto generated by the Gradle buildInit task
 * by 'xxxx' at '14/08/03 23:10' with Gradle 2.0
 *
 * The settings file is used to specify which projects to include in your build.
 * In a single project build this file can be empty or even removed.
 *
 * Detailed information about configuring a multi-project build in Gradle can be found
 * in the user guide at http://gradle.org/docs/2.0/userguide/multi_project_builds.html
 */

/*
// To declare projects as part of a multi-project build use the 'include' method
include 'shared'
include 'api'
include 'services:webservice'
*/

rootProject.name = 'java-project'
</pre><h3>\chapter03\web-project\build.gradle</h3><pre>// (1) Tomcat 플러그인 이용을 위한 설정
buildscript {
  repositories {
    jcenter()
  }
  dependencies {
    classpath 'com.bmuschko:gradle-tomcat-plugin:2.0'
  }
}

//apply plugin: 'java'
// (2) War 플러그인 적용
apply plugin: 'war'
// (3) Tomcat 플러그인 적용
apply plugin: 'com.bmuschko.tomcat'

repositories {
  mavenCentral()
}
	
dependencies {
  // (4) 의존 관계에 Java EE 6의 API추가
  providedCompile 'javax:javaee-web-api:6.0'
  compile 'org.slf4j:slf4j-api:1.7.5'
  testCompile 'junit:junit:4.11'

  // (5) Tomcat 실행에 필요한 의존 라이브러리 설정
  def tomcatVersion = '7.0.52'
    tomcat "org.apache.tomcat.embed:tomcat-embed-core:${tomcatVersion}",
           "org.apache.tomcat.embed:tomcat-embed-logging-juli:${tomcatVersion}"
    tomcat("org.apache.tomcat.embed:tomcat-embed-jasper:${tomcatVersion}") {
      exclude group: 'org.eclipse.jdt.core.compiler', module: 'ecj'
  }
}
</pre><h3>\chapter03\web-project\settings.gradle</h3><pre>/*
 * This settings file was auto generated by the Gradle buildInit task
 * by 'nobusue' at '14/03/23 22:02' with Gradle 1.11
 *
 * The settings file is used to specify which projects to include in your build.
 * In a single project build this file can be empty or even removed.
 *
 * Detailed information about configuring a multi-project build in Gradle can be found
 * in the user guide at http://gradle.org/docs/1.11/userguide/multi_project_builds.html
 */

/*
// To declare projects as part of a multi-project build use the 'include' method
include 'shared'
include 'api'
include 'services:webservice'
*/

rootProject.name = 'web-project'
</pre><h3>\chapter04\add-sourceset\build.gradle</h3><pre>apply plugin: 'java'

sourceSets {
  integrationTest {
    compileClasspath = sourceSets.main.output + configurations.testCompile
    runtimeClasspath = output + compileClasspath + configurations.testCompile
  }
}

repositories {
  mavenCentral()
}

dependencies {
  testCompile "junit:junit:4.11"
  integrationTestCompile  "junit:junit:4.11"
  integrationTestRuntime  "junit:junit:4.11"
}

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

sourceCompatibility = 1.7
targetCompatibility = 1.7

task integrationTest(type: Test) {
  testClassesDir = sourceSets.integrationTest.output.classesDir
  classpath = sourceSets.integrationTest.runtimeClasspath
}
</pre><h3>\chapter04\arithmetic-lib\build.gradle</h3><pre>apply plugin: 'java'

def defaultEncoding = 'UTF-8'
compileJava.options.encoding = defaultEncoding

sourceCompatibility = 1.7
targetCompatibility = 1.7

javadoc {
  options.links << 'http://docs.oracle.com/javase/jp/7/api/'
}
</pre><h3>\chapter04\arithmetic-lib_withApplication\build.gradle</h3><pre>apply plugin: 'java'
apply plugin: 'application'

def defaultEncoding = 'UTF-8'
compileJava.options.encoding = defaultEncoding

sourceCompatibility = 1.7
targetCompatibility = 1.7

mainClassName = 'com.example.cli.SimpleCalc'
applicationName = 'SimpleCalc'

repositories {
	mavenCentral()
}

dependencies {
  compile 'commons-cli:commons-cli:1.2'
}

run {
  standardInput = System.in
}

javadoc {
  options.links << 'http://docs.oracle.com/javase/jp/7/api/'
}
</pre><h3>\chapter04\arithmetic-lib_withTest\build.gradle</h3><pre>apply plugin: 'java'

repositories {
    mavenCentral()
}

dependencies {
    testCompile "junit:junit:4.11"
}

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding
//tasks.withType(JavaCompile) {
//  options.encoding = defaultEncoding
//}

sourceCompatibility = 1.7
targetCompatibility = 1.7

javadoc {
  options.links << 'http://docs.oracle.com/javase/jp/7/api/'
}
</pre><h3>\chapter04\legacy-prj\build.gradle</h3><pre>apply plugin: 'java'

sourceSets {
  main {
    java {
      srcDir 'src'
    }
    resources {
      srcDir 'src'
    }
  }
}

processResources {
  includeEmptyDirs = false
}
</pre><h3>\chapter04\legacy-prj\src\app.properties</h3><pre>prop1=value1
</pre><h3>\chapter05\copy-file\build.gradle</h3><pre>copy {
	from 'original'
	into 'replication'

	include 'example.foo', 'example?.bar', '**/*.txt', 'internal/'
	includeEmptyDirs = false
	
	exclude '**/dummy.txt'
}
</pre><h3>\chapter05\copy-file-with-rename\build.gradle</h3><pre>copy {
	from 'original'
	into 'replication'
	rename { fileName ->
	    if(fileName == 'dummy.txt') {
	        fileName.replace('dummy','renamed-file')
	    }
	}
	rename '(.*)-template.txt', '$1.txt'
}
</pre><h3>\chapter05\delete-file\build.gradle</h3><pre>delete 'target.txt'

delete 'target1.txt', 'target2.txt', 'target3.txt'</pre><h3>\chapter05\file-access\collection\build.gradle</h3><pre>def collections = files('f1.txt', 'f2.txt')
println collections.asPath</pre><h3>\chapter05\file-access\createDir\build.gradle</h3><pre>file('f1.txt').write('あああああ')
file('f2.txt').write('あああああ', 'UTF-8')</pre><h3>\chapter05\file-expand\build.gradle</h3><pre>String targetName = 'SimpleBean'
copy {
    from 'template'
	into 'output'
	
	expand packageName:'com.example.bean', className:targetName, 
	      fields:['String':'name', 'int':'value']

	rename 'template.java', "${targetName}.java"
}
</pre><h3>\chapter05\file-filter\build.gradle</h3><pre>String targetName = 'ConcreteVo'
copy {
    from 'template'
	into 'output'
	filter { line ->
	    line.replaceAll 'VALUE_OBJECT_NAME', "${targetName}"
	    line.replaceAll 'AUTHOR_NAME', 'Gradle2.0 빌드 스크립트'
	}
	filter org.apache.tools.ant.filters.TabsToSpaces, tablength: 4
	rename 'template.java', "${targetName}.java"
}
</pre><h3>\chapter05\file-reference\build.gradle</h3><pre>File mainJava = file('src/main/java/Main.java')
println mainJava.absolutePath

File dummyFile = file(new File('src/dummy.txt'))
println dummyFile.path


File index = null

URL url = new URL('file:/index.html')
index = file(url)
println index.path

URI uri = new URI('file:/index.html')
index = file(uri)
println index.path


import java.util.concurrent.Callable

index = file(new Callable<String>() {
    String call() {
        '/index.html'
    }
})
println index.path

index = file { '/index.html' }
println index.path
</pre><h3>\chapter05\fileCollection\as-path\build.gradle</h3><pre>FileCollection libraries = files('lib1.jar', 'lib2.jar')
// getAsPath()의 Groovy 간략 기법
String librariesPath = libraries.asPath
println librariesPath
</pre><h3>\chapter05\fileCollection\convert\build.gradle</h3><pre>FileCollection collections = files('file1.txt', 'file2.txt', 'file3.txt')

// as 연산자를 이용한 변환
List list = collections as List
Set set1 = collections as Set
File[] array = collections as File[]

// getFiles()의 Groovy 간략 기법
Set set2 = collections.files

println list
println set1
println array
println set2</pre><h3>\chapter05\fileCollection\filtering\build.gradle</h3><pre>FileCollection collections = files('file1.txt', 'file2.txt', new URL('file:/index.html'))
FileCollection textFiles = collections.filter { collectionFile ->
	collectionFile.name.endsWith '.txt'
}
assert textFiles.files.size() == 2
</pre><h3>\chapter05\fileCollection\get-collection\build.gradle</h3><pre>FileCollection collections = files('file1.txt', 'file2.txt')

// 異なる型をまとめて渡してファイルコレクションとする
collections = files('file1.txt', new File('file2.txt'), new URL('file:/index.html'))

println collections

List fileList = [new File('file1.txt'), new File('file2.txt')]
// List型で渡す
collections = files(fileList)
// 配列で渡す
collections = files(fileList as File[])

println collections</pre><h3>\chapter05\fileCollection\lazy-evalutaion\build.gradle</h3><pre>import java.util.concurrent.Callable

FileCollection orgCollection = null
FileCollection newCollection = files( new Callable<List<File>>() {
    List<File> call() {
        println '-- callable#call --'
        orgCollection as List
    }
})
println '-- before set file --'

orgCollection = files('internal')

println '-- after set file --'

println newCollection.singleFile
</pre><h3>\chapter05\fileCollection\operation\build.gradle</h3><pre>ConfigurableFileCollection collections1 = files('file1.txt')

FileCollection collections2 = collections1 + files('file2.txt')
assert collections2.files.size() == 2

collections1 == collections2 - files('file2.txt')
assert collections1.files.size() == 1
</pre><h3>\chapter05\fileCollection\other\build.gradle</h3><pre>FileCollection tempCollection = files('file1.txt')
File file1 = tempCollection.singleFile

// ファイルコレクションが空でなく、'file1.txt'が含まれていたらファイルを削除する。
if(!tempCollection.isEmpty() && tempCollection.contains(file1)) {
    tempCollection -= files(file1) 
}
// 空だったら、StopExecutionException をスローする。
tempCollection.stopExecutionIfEmpty()
</pre><h3>\chapter05\fileTree\build.gradle</h3><pre>FileTree sourceFiles = fileTree('src')
sourceFiles.each { println it.name }

println '-- include *.java --'
FileTree javaFiles = sourceFiles.include '**/*.java'
javaFiles.each { println it.name }

println '-- exclude Something.java --'
FileTree excluded = javaFiles.exclude('**/Something.java')
excluded.each { println it.name }
</pre><h3>\chapter05\fileTree\closure.gradle</h3><pre>FileTree tree = fileTree('src') {
    include '**/*.java'
    exclude '**/Something.java'
}
tree.each { println it.name }</pre><h3>\chapter05\fileTree\map.gradle</h3><pre>FileTree tree = fileTree(dir: 'src', include: '**/*.java', exclude: '**/Something.java')
tree.each { println it.name }
</pre><h3>\chapter05\fileTree\matching.gradle</h3><pre>FileTree tree = fileTree('src')
FileTree javaFiles = tree.matching { include '**/*.java' }
javaFiles.each { println it.name }

FileTree nonJavaFiles = tree.matching { exclude '**/*.java' }
nonJavaFiles.each { println it.name }
</pre><h3>\chapter05\fileTree\src\main\resources\prop.properties</h3><pre></pre><h3>\chapter05\fileTree\visit-by-closure.gradle</h3><pre>FileTree tree = fileTree('src')
tree.visit { fileDetails ->
    println 'name: ' + fileDetails.getName()
    if(fileDetails.isDirectory()) {
      println 'path: ' + fileDetails.getPath()
    } else {
      println 'file size: ' + fileDetails.getSize()
    }
}
</pre><h3>\chapter05\fileTree\visit-by-fileVisitor.gradle</h3><pre>FileTree tree = fileTree('src')
tree.visit(new FileVisitor() {
    void visitDir(FileVisitDetails fileDetails) {
      println 'name: ' + fileDetails.getName()
      println 'path: ' + fileDetails.getPath()
    }

    void visitFile(FileVisitDetails fileDetails) {
      println 'name: ' + fileDetails.getName()
      println 'file size: ' + fileDetails.getSize()
    }
})
</pre><h3>\chapter05\gradle-basic\build.gradle</h3><pre>task greet << { println 'Hello, ' + user }</pre><h3>\chapter05\logging\build.gradle</h3><pre>task showLogInfo << {
    println  '************ showLogInfo task executing ************'
}
</pre><h3>\chapter05\logging\loglevel.gradle</h3><pre>logger.error '에러 메시지'
logger.quiet '중요 메시지'
logger.warn '경고 메시지'
logger.lifecycle '빌드 진행 상황을 보여주는 메시지'
logger.info '정보 메시지'
logger.debug '디버그 메시지'
</pre><h3>\chapter05\make-directory\build.gradle</h3><pre>mkdir 'parent/child/grandchild'
mkdir '../outOfTheProject'
mkdir '/gradle-book/absolutePathDir'</pre><h3>\chapter05\modify-loglevel\build.gradle</h3><pre>logging.captureStandardOutput LogLevel.INFO
logging.captureStandardError LogLevel.INFO
println '표준 출력'
System.err.println '표준 오류'</pre><h3>\chapter05\nest-copy\build.gradle</h3><pre>copy {
    into 'replication'
    exclude '**/dummy.txt'

    from('original') {
        exclude 'sub1/', 'sub2/'
    }
    into('internal') {
        from 'original/sub1', 'original/sub2'
    }
}</pre><h3>\chapter05\path-validation\build.gradle</h3><pre>File existDir = file('src/main/existDir', PathValidation.DIRECTORY)</pre><h3>\chapter05\settings\build.gradle</h3><pre>tasks.whenTaskAdded { task ->
    println task.name
}

task todo << { println 'execute task: ' + name }

task doing << { println 'execute task: ' + name }

task done << { println 'execute task: ' + name }

doing.dependsOn todo
done.dependsOn doing
</pre><h3>\chapter05\settings\settings.gradle</h3><pre>println rootDir
println rootProject.name</pre><h3>\chapter05\taskgraph\build.gradle</h3><pre>tasks.whenTaskAdded { task ->
    println task.name
}

task todo << { println 'execute task: ' + name }

task doing << { println 'execute task: ' + name }

task done << { println 'execute task: ' + name }

doing.dependsOn todo
done.dependsOn doing
</pre><h3>\chapter05\taskgraph-order\build.gradle</h3><pre>tasks.whenTaskAdded { task ->
    println task.name
}

task todo << { println 'execute task: ' + name }

task doing << { println 'execute task: ' + name }

task done << { println 'execute task: ' + name }

//doing.shouldRunAfter todo
done.dependsOn doing
//doing.mustRunAfter done
doing.shouldRunAfter done</pre><h3>\chapter06\section01\project-properties\build.gradle</h3><pre>task greet << {
    println message
}</pre><h3>\chapter06\section01\project-properties\gradle.properties</h3><pre>message=Hello
</pre><h3>\chapter06\section01\script-block-explaination\build.gradle</h3><pre>println '기본 의존 관계：'
repositories.each { println it.name }

// Gradle DSL
/*
repositories {
    mavenCentral()
}
*/

// Groovy 형식
//def closure = { mavenCentral() }
//this.repositories(closure)

// Gradle Domain Object
RepositoryHandler repos = this.getRepositories()
repos.mavenCentral()

println 'Maven Central 리포지토리 추가 후：'
repositories.each { println it.name }</pre><h3>\chapter06\section01\script-structure\build.gradle</h3><pre>  class Descriptor {
    String show() {
      '*** 이것은 Groovy입니다. ***'
    }
  }
  println new Descriptor().show()</pre><h3>\chapter06\section01\system-properties\build.gradle</h3><pre>task greet << {
    println System.properties['message']
}</pre><h3>\chapter06\section01\system-properties\gradle.properties</h3><pre>systemProp.message=Hello</pre><h3>\chapter06\section01\variables\build.gradle</h3><pre>
import java.sql.Timestamp

def date = new Date()
println date

Timestamp ts = new Timestamp(date.getTime())
println ts

  def scriptScope = 'SCRIPT'

  task getMessage() << {
    def taskScope = 'TASK'
    if(message) {
      println scriptScope + ':' + taskScope + ':' + message
    } else {
      def localScope = 'LOCAL'
      println scriptScope + ':' + taskScope + ':' + localScope
    }
  }

  println scriptScope
//  println taskScope   // 범위 밖
//  println localScope  // 범위 밖</pre><h3>\chapter06\section02\default-task\build.gradle</h3><pre>defaultTasks 'showProjectName'

// 여러 태스크를 지정하는 경우
//defaultTasks = ['showProjectName','showDescription']

project.description = '기본 태스크 설명을 위한 프로젝트'

task showProjectName << {
	println project.name
}

task showDescription << {
	println project.description
}
</pre><h3>\chapter06\section02\extensionAware-object\build.gradle</h3><pre>class MutableObject {
	private String property

	String getProperty() { return property; }

	void setProperty(String property) {
	    this.property = property
	}
}

project.extensions.create('mutable', MutableObject)
project.mutable.property = 'MutableObjectです。'

task showMutableObject << {
    println project.mutable.property
}


class ImmutableObject {
	private String property

	ImmutableObject(String property) {
	    this.property = property
	}

	String getProperty() { return property; }
}

extensions.create('imutable', ImmutableObject, 'ImmutableObjectです。')

task showImmutableObject << {
	println imutable.property
}</pre><h3>\chapter06\section02\extraPropertiesExtension-object\build.gradle</h3><pre>// ExtraPropertiesExtension
project.ext.set('property', 'ext에 추가한 속성이다.')

if(project.ext.has('property')) {
    println '확장 속성의 값: ' + project.ext.get('property')
}

// Groovy 속성 참조
project.ext.property = 'ext에 추가한 속성이다.。'
println '확장 속성의 값: ' + project.property

// Map 리터럴 형식
project.ext['property'] = 'ext에 추가한 속성이다.'
println '확장 속성의 값: ' + project.ext['property']

// 클로저를 사용한 설정
project.ext {
    prop1 = 'aaa'
    prop2 = 'bbb'
}
println project.ext.prop1 + project.ext.prop2
</pre><h3>\chapter06\section02\gradle-object\init-callback.gradle</h3><pre>// gradle 을 생략
settingsEvaluated {
    println '1. settingsEvaluated'
}

projectsLoaded {
    println '2. projectsLoaded'
}

beforeProject {
    println '3. beforeProject'
}

afterProject {
    println '4. afterProject'    
}

projectsEvaluated {
    println '5. projectsEvaluated'
}

buildFinished {
    println '6. buildFinished'    
}</pre><h3>\chapter06\section02\gradle-object\init.gradle</h3><pre>class MyTaskActionListener implements TaskActionListener {
    void beforeActions(Task task) {
        println '-- ' + task.name + '태스크 액션 실행 전 --'
    }
    void afterActions(Task task) {
        println '-- ' + task.name + '태스크 액션 실행 후 --'
    }	
}

//gradle.addListener(new MyTaskActionListener())</pre><h3>\chapter06\section02\project-object\init.gradle</h3><pre>gradle.allprojects { project ->
    project.beforeEvaluate {
        println project.name + '프로젝트를 평가한다.'
    }
    project.afterEvaluate {
        println project.name + '프로젝트를 평가했다.'
    }
}</pre><h3>\chapter06\section02\project-object\project-reference.gradle</h3><pre>def childInstance = project(':child')
childInstance.description = '자식 프로젝트의 설명을 설정한다.'

// 오버로드 메서드의 경우
/*
project(':child') {
    description = '자식 프로젝트의 설명을 설정한다.'
}
*/</pre><h3>\chapter06\section02\project-object\settings.gradle</h3><pre>include 'child'

gradle.allprojects { project ->
    if(project.name == 'methods-desc') {
        project.beforeEvaluate {
            println project.name + '프로젝트를 평가한다.'
        }
        project.afterEvaluate {
            println project.name + '프로젝트를 평가했다.'
        }
    }
}
</pre><h3>\chapter06\section02\project-object\task-definition.gradle</h3><pre>task hello << {
    println 'Hello Gradle world!'
}

// API 형식
//def helloTask = task('hello')
//helloTask << { println 'Hello Gradle world!' }</pre><h3>\chapter06\section02\settings-object\application-project\application.gradle</h3><pre>task showBuildFileName << {
	println buildFile.name
}</pre><h3>\chapter06\section02\settings-object\domain-project\domain.gradle</h3><pre>task showBuildFileName << {
	println buildFile.name
}</pre><h3>\chapter06\section02\settings-object\infrastructure-project\infrastructure.gradle</h3><pre>task showBuildFileName << {
	println buildFile.name
}</pre><h3>\chapter06\section02\settings-object\presentation-project\presentation.gradle</h3><pre>task showBuildFileName << {
	println buildFile.name
}</pre><h3>\chapter06\section02\settings-object\settings.gradle</h3><pre>include 'presentation-project', 'application-project', 'domain-project', 'infrastructure-project'

rootProject.children.each { project ->
    def layerName = project.name.replaceAll('-project', '')
    def buildScriptFile = "${layerName}.gradle"
    project.buildFileName = buildScriptFile

    println "프로젝트/빌드 스크립트명:: ${project.name}／${buildScriptFile}"
}

println findProject(':invalid-path')
println project(':invalid-path')</pre><h3>\chapter06\section02\task-object\main-api.gradle</h3><pre>task myActionTask {
    doFirst {
        println 'First!'
    }
}

myActionTask.doLast {
    println 'Last!'
}

myActionTask << { println 'Last by leftShift!' }

myActionTask.deleteAllActions()</pre><h3>\chapter06\section02\task-object\property.gradle</h3><pre>task myTask << {
    println name
}

myTask.group 'help'
myTask.description 'myTask입니다.'
</pre><h3>\chapter06\section03\dynamic-task\build.gradle</h3><pre>def instances = ['AppServer': '192.0.2.10', 'DBServer': '192.0.2.20', 'MailServer': '192.0.2.30']

instances.each { serverType, ipAddress ->
    task "show${serverType}" << {
        println ipAddress
    }
}</pre><h3>\chapter06\section03\finalizer-task\build.gradle</h3><pre>task normalTask << {
    println name
}

task finalizerTask << {
    println name
}

task problemTask << {
    throw new Exception('exception')
}
  
task executionTask << { println name }

normalTask.finalizedBy finalizerTask

// finalizerTask가 실행된다
//problemTask.dependsOn normalTask
//executionTask.dependsOn problemTask

// finalizerTask가 실행되지 않는다
normalTask.dependsOn problemTask
executionTask.dependsOn normalTask</pre><h3>\chapter06\section03\general-task\build.gradle</h3><pre>task myCopy(type: Copy) {
    from 'original'
    into 'target'
}

task myCopyExtension(type: Copy) {
    from 'original'
    into 'target'

    File newFile = file('original/newFile.txt')
    doFirst {
      println '복사 대상 파일에 내용을 기록합니다.'
      newFile.write('복사용 파일입니다.','UTF-8')
    }
    doLast {
      File copied = file('original/newFile_copied.txt')
      if(newFile.renameTo(copied)) {
        println '복사를 완료했습니다.'
      } else {
        println '복사에 실패했습니다.'
      }
    }
}
</pre><h3>\chapter06\section03\ordering\build.gradle</h3><pre>task before << {
     println '먼저 실행한다'
}
  
task after << {
    println '나중에 실행한다'
}
  
after.mustRunAfter before

// NG
//before.dependsOn after
</pre><h3>\chapter06\section03\ordering\shouldRunAfter.gradle</h3><pre>task before << {
     println '먼저 실행한다'
}
  
task after << {
    println '나중에 실행한다'
}

after.shouldRunAfter before

// OK
//before.dependsOn after
</pre><h3>\chapter06\section03\overwrite\build.gradle</h3><pre>apply plugin: 'java'

task assemble(overwrite: true) << {
  println '덮어쓰기 했습니다'
}

// InvalidUserDataExceptionがスローされます。
/*
task assemble(overwrite: false) << {
  println '덮어쓰기 했습니다'
}
*/</pre><h3>\chapter06\section03\skip-task\build.gradle</h3><pre>task specialTask << {
    println '특별한 처리를 실행합니다'
}

specialTask.onlyIf {
    buildType == 'partial-build'
}


task skippedIfExceptionOccurred << {
    println 'start'
}

skippedIfExceptionOccurred << {
    if(process == 'error') {
        throw new StopExecutionException()
    }
}

skippedIfExceptionOccurred << {
    println 'end'
}</pre><h3>\chapter06\section03\task-basic\build.gradle</h3><pre>task hello << {
    println name + ': Hello Gradle world!'
}

task hello2 {
    println name + ': Hello Gradle world!'
}

task showDescription << {
    println description
}
showDescription.description = 'showDescription태스크입니다.'

// 이건 에러 처리된다
/*
task showDescription2.description = 'showDescription2태스크입니다.'
showDescription2 << {
    println description
}
*/

task showDescription3
showDescription3.description = 'showDescription3태스크입니다.'
showDescription3 << {
    println description
}

task showDescription4 {
	description = 'showDescription4태스크입니다.'
	doLast {
	    println description
	}
}

task showDescription5(description: 'showDescription5태스크입니다.') << {
    println description
}

task(showDescription6, description: 'showDescription6태스크입니다.') << {
    println description
}



</pre><h3>\chapter06\section03\task-dependency\build.gradle</h3><pre>task todo << {
     println '미착수'
}

task doing << {
    println '작업중'
}

task done << {
    println '완료'
}

doing.dependsOn todo
done.dependsOn doing


task reviewing << {
    println '검토중'
}

// 여러 태스크에 의존하는 경우
/*
task done(dependsOn: [doing, reviewing]) << {
    println '완료'
}
*/

// 클로저를 사용한 경우合
/*
done.dependsOn {
  [doing, reviewing]
}
*/

// 패턴에 일치하는 것을 의존 관계로 설정하는 경우
/*
done.dependsOn {
    tasks.findAll { task -> task.name ==~ /.*ing/ }
}
*/</pre><h3>\chapter06\section03\task-rule\build.gradle</h3><pre>apply plugin: 'java'

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.slf4j:slf4j-api:1.7.5'
    testCompile 'junit:junit:4.11'
}

tasks.addRule('Pattern: show<TASKS_NAME>: Show task name.') { taskName ->
  if(taskName.startsWith('show')) {
    task(taskName) << {
	  println '*** ' + taskName + ' ***'
    }
  }
}</pre><h3>\chapter06\section05\arithmetic-flat\arithmetic-main\build.gradle</h3><pre>apply plugin: 'application'

mainClassName = 'com.example.cli.SimpleCalc'
applicationName = 'SimpleCalc'
  
dependencies {
    compile project(':arithmetic-lib')
}
  
run {
    standardInput = System.in
}

project(':arithmetic-lib') {
	task show << {
	    println project.name + ' show()'
	}
}
</pre><h3>\chapter06\section05\arithmetic-flat\master\build.gradle</h3><pre>subprojects {
    apply plugin: 'java'
  
    def defaultEncoding = 'UTF-8'
    compileJava.options.encoding = defaultEncoding
  
    sourceCompatibility = 1.7
    targetCompatibility = 1.7
  
    javadoc {
      options.links << 'http://docs.oracle.com/javase/jp/7/api/'
    }
}
</pre><h3>\chapter06\section05\arithmetic-flat\master\settings.gradle</h3><pre>includeFlat 'arithmetic-main', 'arithmetic-lib'</pre><h3>\chapter06\section05\arithmetic-hierarchy\build.gradle</h3><pre>// 공통 설정
subprojects {
    apply plugin: 'java'
  
    def defaultEncoding = 'UTF-8'
    compileJava.options.encoding = defaultEncoding
  
    sourceCompatibility = 1.7
    targetCompatibility = 1.7
  
    javadoc {
      options.links << 'http://docs.oracle.com/javase/jp/7/api/'
    }
}
  
  
// 라이브러리 프로젝트
project('arithmetic-lib') {}
  
  
// 애플리케이션 프로젝트
project('arithmetic-main') {
    apply plugin: 'application'
  
    mainClassName = 'com.example.cli.SimpleCalc'
    applicationName = 'SimpleCalc'
  
    dependencies {
      compile project(':arithmetic-lib')
    }
  
    run {
      standardInput = System.in
    }
}</pre><h3>\chapter06\section05\arithmetic-hierarchy\settings.gradle</h3><pre>include 'arithmetic-lib', 'arithmetic-main'</pre><h3>\chapter06\section05\arithmetic-hierarchy-with-task\build.gradle</h3><pre>// 공통 설정
subprojects {
    apply plugin: 'java'
  
    def defaultEncoding = 'UTF-8'
    compileJava.options.encoding = defaultEncoding
  
    sourceCompatibility = 1.7
    targetCompatibility = 1.7
  
    javadoc {
      options.links << 'http://docs.oracle.com/javase/jp/7/api/'
    }

    task commonTask << {
      println project.name + '의' + name + '태스크입니다.' 
    }
}
  
  
// 라이브러리 프로젝트
project('arithmetic-lib') {
    task limitedTask << {
      println project.name + '전용 태스크입니다.'
    }
}
  
  
// 애플리케이션 프로젝트
project('arithmetic-main') {
    apply plugin: 'application'
  
    mainClassName = 'com.example.cli.SimpleCalc'
    applicationName = 'SimpleCalc'
  
    dependencies {
      compile project(':arithmetic-lib')
    }
  
    run {
      standardInput = System.in
    }

    commonTask {
        doFirst {
            println '=' * 20 + " ${name} start " + '=' * 20
        }
        doLast {
            println '=' * 20 + " ${name}  end  " + '=' * 20
        }
        dependsOn ':arithmetic-lib:limitedTask'
    }
}</pre><h3>\chapter06\section05\arithmetic-hierarchy-with-task\settings.gradle</h3><pre>include 'arithmetic-lib', 'arithmetic-main'</pre><h3>\chapter06\section05\multi-root\build.gradle</h3><pre>subprojects {
  println "[${project.name}]: ${project.projectDir}"
}
</pre><h3>\chapter06\section05\multi-root\master\build.gradle</h3><pre>subprojects {
  println "[${project.name}]: ${project.projectDir}"
}
</pre><h3>\chapter06\section05\multi-root\master\settings.gradle</h3><pre>includeFlat 'child:grandchild:great-grandchild'</pre><h3>\chapter06\section05\multi-root\settings.gradle</h3><pre>include 'child:grandchild:great-grandchild'</pre><h3>\chapter07\clientmodule\build.gradle</h3><pre>repositories {
  flatDir {
    dirs "libs"
  }
}

configurations {
  conf1
  testConf1.extendsFrom conf1 // testConf1은 conf의 의존 관계도 포함한다
}

dependencies {
  conf1 group: 'org.codehaus.groovy', name: 'groovy-all', version: '2.3.1'
  testConf1 module('org.spockframework:spock-core:0.7-groovy-2.0') { // 클라이언트 모듈 설정
    dependency 'org.codehaus.groovy:groovy-all:2.3.1'
    dependency 'org.hamcrest:hamcrest-core:1.3'
    module(group: 'junit', name: 'junit-dep', version: '4.10') {
      dependency  group: 'org.hamcrest', name: 'hamcrest-core', version: '1.3'
    }
  }
}

task showDeps << {
  // libs 디렉터리의 groovy-all-2.3.1.jar、spock-core-0.7-groovy-2.0.jar、
  // hamcrest-core-1.3.jar、junit-dep-4.10.jar 경로가 출력된다
  configurations.testConf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\extends-configuration\build.gradle</h3><pre>repositories {
  mavenCentral()
}

configurations {
  conf1
  testConf1.extendsFrom conf1 // testConf1은 conf의 의존 관계도 포함한다
}

dependencies {
  conf1 group: 'org.codehaus.groovy', name: 'groovy-all', version: '2.3.1'
  testConf1 group: 'junit', name: 'junit', version: '4.11'
}

task showDeps << {
  // groovy-all-2.3.1.jar의 경로도 출력된다
  configurations.testConf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\flat-dir-repositories\build.gradle</h3><pre>// build.gradle

configurations {
  conf1
}

repositories {
    flatDir {
        // 프로젝트 디렉터리의 libs、doc-repo 디렉터리를 리포지토리로 지정
        dirs "libs", "doc-repo"
    }
}

dependencies {
  conf1 group: "org.slf4j", name: "slf4j-api", version: "1.7.5"
  conf1 group: "junit", name: "junit", version: "4.11"
  conf1 name: "index", ext: "html"
}

task showDeps << {
  // conf1에 설정된 의존 관계의 파일 경로를 모두 출력한다
  configurations.conf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\geregere\build.gradle</h3><pre>// geregere/build.gradle

group = "geregere"
version = 0.1

configurations {
    conf1
    conf2
}

dependencies {
  conf1 group: 'com.example', name: 'aaa', version: '0.1'
  conf2 group: 'com.example', name: 'bbb', version: '0.1'
}

// ...

</pre><h3>\chapter07\gradle-api-dependencies\build.gradle</h3><pre>configurations {
  conf1
}

dependencies {
  conf1 gradleApi()
}

task showDeps << {
  configurations.conf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\hierarchical-libs-dir\build.gradle</h3><pre>// 리스트1
configurations {
  conf1
}

dependencies {
  conf1 fileTree(dir: "libs", include: "**/*.jar")
}

task showDeps << {
  configurations.conf1.each {
    println it.absolutePath
  }
  //출력
  // /xxx/xx/libs/sample-lib.jar
  // /xxx/xx/libs/lib-a/sample-a-lib.jar
}

</pre><h3>\chapter07\local-groovy-dependencies\build.gradle</h3><pre>configurations {
  conf1
}

dependencies {
  conf1 localGroovy()
}

task showDeps << {
  configurations.conf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\simple-dependencies\build.gradle</h3><pre>// 리스트1
configurations {
  conf1
}

dependencies {
  conf1 files("libs/sample-lib.jar")
}

task showDeps << {
  configurations.conf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\simple-dynamic-dependencies\build.gradle</h3><pre>configurations {
  conf1
}

repositories {
  mavenCentral()
  maven {
      url "http://repository.apache.org/content/groups/snapshots"
  }
}

// conf1 컨피겨레이션의 동적 버전 캐시 간격 설정
configurations.conf1.resolutionStrategy.cacheDynamicVersionsFor 1, 'minutes'
// conf1 컨피겨레이션의 변경성 모듈 캐시 간격 설정
configurations.conf1.resolutionStrategy.cacheChangingModulesFor 5, 'hours'

dependencies {
  conf1 'org.slf4j:slf4j-api:1.7.+' // 1.7 대 버전 중 최신 버전
  conf1 'commons-cli:commons-cli:latest.integration' // 불안정 버전도 포함해서 최신 버전 취득
  conf1 'junit:junit:latest.release' // 안전화 버전의 최신판 취득
}

task showDeps << {
  configurations.conf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\simple-explicit-notation\build.gradle</h3><pre>configurations {
  conf1
}

repositories {
  mavenCentral()
}

dependencies {
  conf1 group: 'org.slf4j', name: 'slf4j-api', version: '1.7.5'
}

task showDeps << {
  configurations.conf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\simple-external-dependencies\build.gradle</h3><pre>// 리스트2

configurations {
  conf1
}

repositories {
  mavenCentral()
}

dependencies {
  conf1 'org.slf4j:slf4j-api:1.7.5'
}

task showDeps << {
  configurations.conf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\transitive-conflict-dependencies\build.gradle</h3><pre>repositories {
  mavenCentral()
}

configurations {
  conf1
  testConf1.extendsFrom conf1 // testConf1는 conf의 의존 관계를 포함
}

dependencies {
  conf1 group: 'org.codehaus.groovy', name: 'groovy-all', version: '2.3.1'
  testConf1 group: 'org.spockframework', name: 'spock-core', version: '0.7-groovy-2.0'
}

task showDeps << {
  // groovy-all-2.3.1 or groovy-all-2.0.5.jar ?
  configurations.testConf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\transitive-conflict-fail-dependencies\build.gradle</h3><pre>repositories {
  mavenCentral()
}

configurations {
  conf1
  testConf1.extendsFrom conf1 // testConf1는 conf의 의존 관계도 포함
}

configurations.testConf1 {
  resolutionStrategy {
    failOnVersionConflict()  // Fail 전략 채택
  }
}

dependencies {
  conf1 group: 'org.codehaus.groovy', name: 'groovy-all', version: '2.3.1'
  testConf1 group: 'org.spockframework', name: 'spock-core', version: '0.7-groovy-2.0'
}

task showDeps << {
  // A conflict was found between the following modules.. 라는 메시지와 함께 빌드되지 않는다
  configurations.testConf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\transitive-dependencies\build.gradle</h3><pre>repositories {
  mavenCentral()
}

configurations {
  testConf1
}

dependencies {
  testConf1 group: 'org.spockframework', name: 'spock-core', version: '0.7-groovy-2.0'
}

task showDeps << {
  // spock、groovy、junit、hamcrest 경로가 출력된다
  configurations.testConf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\transitive-exclude\build.gradle</h3><pre>repositories {
  mavenCentral()
}

configurations {
  conf1
  testConf1.extendsFrom conf1 // testConf1는 conf의 의존 관계도 포함
}

configurations.testConf1 {
  resolutionStrategy {
    failOnVersionConflict()  // Fail 전략 도입
  }
}

dependencies {
  conf1 group: 'org.codehaus.groovy', name: 'groovy-all', version: '2.3.1'
  testConf1(group: 'org.spockframework', name: 'spock-core', version: '0.7-groovy-2.0') {
    exclude module: 'groovy-all' // groovy-all은 무시한다
  }
}

task showDeps << {
  // Groovy는 버전 2.3.1만 남고 버전 경합이 해결된다
  configurations.testConf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\transitive-forcing-version\build.gradle</h3><pre>repositories {
  mavenCentral()
}

configurations {
  conf1
  testConf1.extendsFrom conf1 // testConf1는 conf의 의존 관계도 포함
}

configurations.testConf1 { // 컨피겨레이션 testConf1 설정
  resolutionStrategy {
    failOnVersionConflict()  // Fail 전략 도입
    force 'org.hamcrest:hamcrest-core:1.3' // testConf1에서 Hamcrest가 요구되면 반드시 버전 1.3을 사용한다
  }
}

dependencies {
  conf1(group: 'org.codehaus.groovy', name: 'groovy-all', version: '2.3.1') {
    force = true // 버전이 경합하면 반드시 의존 관계를 사용한다
  }
  testConf1(group: 'org.spockframework', name: 'spock-core', version: '0.7-groovy-2.0')
}

task showDeps << {
  // 버전 경합은 모두 해결되며 빌드에 성공한다
  configurations.testConf1.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\yoreyore\build-error.gradle</h3><pre>// yoreyore/build.gradle

repositories {
   ivy {
     url "http://localhost:8000"
     layout 'pattern' , {
       artifact '[organisation]/[module]/[artifact]-[revision](.[ext])'
       ivy '[organisation]/[module]/ivy.xml'
     }
   }
}

configurations {
  compile
}

dependencies {
  compile group: 'geregere', name: 'geregere', version: '0.1'
}

task showDeps << {
  configurations.compile.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter07\yoreyore\build.gradle</h3><pre>// yoreyore/build.gradle

repositories {
   ivy {
     url "http://localhost:8000"
     layout 'pattern' , {
       artifact '[organisation]/[module]/[artifact]-[revision](.[ext])'
       ivy '[organisation]/[module]/ivy.xml'
     }
   }
}

configurations {
  compile
}

dependencies {
  compile group: 'geregere', name: 'geregere', version: '0.1', configuration: "conf1"
}

task showDeps << {
  configurations.compile.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter08\book-crud\build.gradle</h3><pre>apply plugin: 'war'
apply plugin: 'groovy'

buildscript {
  repositories {
    jcenter()
  }
  dependencies {
    classpath 'com.bmuschko:gradle-tomcat-plugin:2.0'
  }
}
apply plugin: 'com.bmuschko.tomcat-base'

ext {
  tomcatStopPort = 8081
  tomcatStopKey = 'stopKey'
}

sourceSets {
    integrationTest {
        groovy.srcDir file('src/integrationTest/groovy')
        resources.srcDir file('src/integrationTest/resources')
        compileClasspath = sourceSets.main.output + configurations.testCompile
        runtimeClasspath = output + compileClasspath + configurations.testRuntime
    }
    functionalTest {
        groovy.srcDir file('src/functionalTest/groovy')
        resources.srcDir file('src/functionalTest/resources')
        compileClasspath = sourceSets.main.output + configurations.testCompile
        runtimeClasspath = output + compileClasspath + configurations.testRuntime
    }
}

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava, compileIntegrationTestGroovy, compileFunctionalTestGroovy]*.options*.encoding = defaultEncoding

sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.mybatis:mybatis:3.2.6'
    compile 'org.mybatis:mybatis-spring:1.2.2'
    compile 'org.aspectj:aspectjweaver:1.7.4'
    compile 'org.springframework:spring-context:4.0.3.RELEASE'
    compile 'org.springframework:spring-webmvc:4.0.3.RELEASE'
    compile 'org.springframework:spring-jdbc:4.0.3.RELEASE'
    compile 'org.thymeleaf:thymeleaf:2.1.2.RELEASE'
    compile 'org.thymeleaf:thymeleaf-spring4:2.1.2.RELEASE'
    compile 'log4j:log4j:1.2.16'
    
    // unit test
    testCompile 'junit:junit:4.11'
	testCompile 'org.mockito:mockito-core:1.9.5'

    // integration test
    testCompile 'org.spockframework:spock-core:0.7-groovy-2.0'
    testCompile 'org.spockframework:spock-spring:0.7-groovy-2.0'
    testCompile 'org.springframework:spring-test:4.0.3.RELEASE'
    // functional test
    testCompile "org.gebish:geb-core:0.9.2"
    testCompile 'org.gebish:geb-spock:0.9.2'
    testCompile "org.seleniumhq.selenium:selenium-firefox-driver:2.43.1"
    testCompile "org.seleniumhq.selenium:selenium-support:2.43.1"
    
    runtime 'com.h2database:h2:1.3.175'
    runtime 'org.slf4j:slf4j-api:1.6.1'
    runtime 'org.slf4j:slf4j-log4j12:1.6.1'
    
    def tomcatVersion = '7.0.52'
    tomcat "org.apache.tomcat.embed:tomcat-embed-core:${tomcatVersion}",
           "org.apache.tomcat.embed:tomcat-embed-logging-juli:${tomcatVersion}"
    tomcat("org.apache.tomcat.embed:tomcat-embed-jasper:${tomcatVersion}") {
      exclude group: 'org.eclipse.jdt.core.compiler', module: 'ecj'
    }
}

test {
    maxParallelForks = 2
    reports.html.destination = file("$reports.html.destination/unit")
    reports.junitXml.destination = file("$reports.junitXml.destination/unit")
}

task copyEnvironmentResource(type: Copy) {
	description "env.properties를 복사한다"
	from "environments/${env}/env.properties"
	into project.sourceSets.main.output.resourcesDir
}
classes.dependsOn copyEnvironmentResource

task integrationTest(type: Test) {
    group = 'verification'
    testClassesDir = sourceSets.integrationTest.output.classesDir
    classpath = sourceSets.integrationTest.runtimeClasspath
    reports.html.destination = file("$reports.html.destination/integration")
    reports.junitXml.destination = file("$reports.junitXml.destination/integration")
}

task tomcatRun4FunctionalTest(type: com.bmuschko.gradle.tomcat.tasks.TomcatRunWar) {
    stopPort = tomcatStopPort
    stopKey = tomcatStopKey
    daemon = true
}

task tomcatStop4FunctionalTest(type: com.bmuschko.gradle.tomcat.tasks.TomcatStop) {
    stopPort = tomcatStopPort
    stopKey = tomcatStopKey
}

task functionalTest(type: Test) {
    group = 'verification'
    testClassesDir = sourceSets.functionalTest.output.classesDir
    classpath = sourceSets.functionalTest.runtimeClasspath
    reports.html.destination = file("$reports.html.destination/functional")
    reports.junitXml.destination = file("$reports.junitXml.destination/functional")
    
    systemProperty 'geb.env', 'firefox'
    systemProperty 'geb.build.reportsDir', reporting.file("functional/geb")
	
	dependsOn tomcatRun4FunctionalTest
    finalizedBy tomcatStop4FunctionalTest

    minHeapSize = '512m'
    maxHeapSize = '512m'
    jvmArgs '-XX:PermSize=128m'
    jvmArgs '-XX:MaxPermSize=128m'
}
</pre><h3>\chapter08\book-crud\environments\functional\env.properties</h3><pre>driverClass=org.h2.Driver
url=jdbc:h2:mem:testdb;MODE=PostgreSQL;DB_CLOSE_DELAY=-1;TRACE_LEVEL_SYSTEM_OUT=2
username=h2
password=db</pre><h3>\chapter08\book-crud\environments\integration\env.properties</h3><pre>driverClass=org.h2.Driver
url=jdbc:h2:mem:testdb;MODE=PostgreSQL;DB_CLOSE_DELAY=-1;TRACE_LEVEL_SYSTEM_OUT=2
username=h2
password=db</pre><h3>\chapter08\book-crud\environments\production\env.properties</h3><pre>driverClass=org.postgresql.Driver
url=jdbc:postgresql:proddb
username=bookAdmin
password=gradlegradle</pre><h3>\chapter08\book-crud\environments\unit\env.properties</h3><pre># dummy file for task copyEnvironmentResource</pre><h3>\chapter08\book-crud\initial-build.gradle</h3><pre>apply plugin: 'war'

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.mybatis:mybatis:3.2.6'
    compile 'org.mybatis:mybatis-spring:1.2.2'
    compile 'org.aspectj:aspectjweaver:1.7.4'
    compile 'org.springframework:spring-context:4.0.3.RELEASE'
    compile 'org.springframework:spring-webmvc:4.0.3.RELEASE'
    compile 'org.springframework:spring-jdbc:4.0.3.RELEASE'
    compile 'org.thymeleaf:thymeleaf:2.1.2.RELEASE'
    compile 'org.thymeleaf:thymeleaf-spring4:2.1.2.RELEASE'
    compile 'log4j:log4j:1.2.16'
    
    runtime 'com.h2database:h2:1.3.175'
    runtime 'org.slf4j:slf4j-api:1.6.1'
    runtime 'org.slf4j:slf4j-log4j12:1.6.1'
}
</pre><h3>\chapter08\book-crud\integration-build.gradle</h3><pre>apply plugin: 'war'
apply plugin: 'groovy'

sourceSets {
    integrationTest {
        groovy.srcDir file('src/integrationTest/groovy')
        resources.srcDir file('src/integrationTest/resources')
        compileClasspath = sourceSets.main.output + configurations.testCompile
        runtimeClasspath = output + compileClasspath + configurations.testRuntime
    }
}

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava, compileIntegrationTestGroovy]*.options*.encoding = defaultEncoding

sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.mybatis:mybatis:3.2.6'
    compile 'org.mybatis:mybatis-spring:1.2.2'
    compile 'org.aspectj:aspectjweaver:1.7.4'
    compile 'org.springframework:spring-context:4.0.3.RELEASE'
    compile 'org.springframework:spring-webmvc:4.0.3.RELEASE'
    compile 'org.springframework:spring-jdbc:4.0.3.RELEASE'
    compile 'org.thymeleaf:thymeleaf:2.1.2.RELEASE'
    compile 'org.thymeleaf:thymeleaf-spring4:2.1.2.RELEASE'
    compile 'log4j:log4j:1.2.16'
    
    // unit test
    testCompile 'junit:junit:4.11'
	testCompile 'org.mockito:mockito-core:1.9.5'

    // integration test
    testCompile 'org.spockframework:spock-core:0.7-groovy-2.0'
    testCompile 'org.spockframework:spock-spring:0.7-groovy-2.0'
    testCompile 'org.springframework:spring-test:4.0.3.RELEASE'
    
    runtime 'com.h2database:h2:1.3.175'
    runtime 'org.slf4j:slf4j-api:1.6.1'
    runtime 'org.slf4j:slf4j-log4j12:1.6.1'
}

test {
    maxParallelForks = 2
    reports.html.destination = file("$reports.html.destination/unit")
    reports.junitXml.destination = file("$reports.junitXml.destination/unit")
}

task copyEnvironmentResource(type: Copy) {
	description "env.properties를 복사합니다."
	from "environments/${env}/env.properties"
	into project.sourceSets.main.output.resourcesDir
}
classes.dependsOn copyEnvironmentResource

task integrationTest(type: Test) {
    group = 'verification'
    testClassesDir = sourceSets.integrationTest.output.classesDir
    classpath = sourceSets.integrationTest.runtimeClasspath
    reports.html.destination = file("$reports.html.destination/integration")
    reports.junitXml.destination = file("$reports.junitXml.destination/integration")
}
</pre><h3>\chapter08\book-crud\src\main\resources\log4j.properties</h3><pre>log4j.rootLogger                = WARN, stdout

log4j.appender.stdout           = org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout    = org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d %5p [%c{1}] (%F:%L) - %m%n

log4j.logger.org.thymeleaf=INFO
log4j.logger.org.thymeleaf.TemplateEngine.CONFIG=INFO
log4j.logger.org.thymeleaf.TemplateEngine.TIMER=INFO
log4j.logger.org.thymeleaf.TemplateEngine.cache.TEMPLATE_CACHE=INFO
log4j.logger.org.thymeleaf.TemplateEngine.cache.FRAGMENT_CACHE=INFO
log4j.logger.org.thymeleaf.TemplateEngine.cache.MESSAGE_CACHE=INFO
log4j.logger.org.thymeleaf.TemplateEngine.cache.EXPRESSION_CACHE=INFO
log4j.logger.thymeleafexamples=INFO</pre><h3>\chapter08\book-crud\src\main\resources\messages.properties</h3><pre>title.application=\u30b5\u30f3\u30d7\u30eb\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3

title.list=\u66f8\u7c4d\u4e00\u89a7\u753b\u9762
title.create=\u66f8\u7c4d\u767b\u9332\u753b\u9762
title.edit=\u66f8\u7c4d\u7de8\u96c6\u753b\u9762
title.detail=\u66f8\u7c4d\u8a73\u7d30\u753b\u9762

header.list=\u66f8\u7c4d\u4e00\u89a7
header.create=\u66f8\u7c4d\u767b\u9332
header.edit=\u66f8\u7c4d\u7de8\u96c6
header.detail=\u66f8\u7c4d\u8a73\u7d30

book.id=ID
book.title=\u66f8\u7c4d\u540d
book.isbn=ISBN(13\u6841)

link.toCreate=\u65b0\u898f\u767b\u9332
link.toDetail=\u8868\u793a
link.toEdit=\u7de8\u96c6
link.backToList=\u4e00\u89a7\u753b\u9762\u306b\u623b\u308b
link.backToDetail=\u8a73\u7d30\u753b\u9762\u306b\u623b\u308b

button.create=\u767b\u9332
button.update=\u66f4\u65b0
button.delete=\u524a\u9664</pre><h3>\chapter08\book-crud\unit-build.gradle</h3><pre>apply plugin: 'war'

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.mybatis:mybatis:3.2.6'
    compile 'org.mybatis:mybatis-spring:1.2.2'
    compile 'org.aspectj:aspectjweaver:1.7.4'
    compile 'org.springframework:spring-context:4.0.3.RELEASE'
    compile 'org.springframework:spring-webmvc:4.0.3.RELEASE'
    compile 'org.springframework:spring-jdbc:4.0.3.RELEASE'
    compile 'org.thymeleaf:thymeleaf:2.1.2.RELEASE'
    compile 'org.thymeleaf:thymeleaf-spring4:2.1.2.RELEASE'
    compile 'log4j:log4j:1.2.16'
    
    // unit test
    testCompile 'junit:junit:4.11'
	testCompile 'org.mockito:mockito-core:1.9.5'
    
    runtime 'com.h2database:h2:1.3.175'
    runtime 'org.slf4j:slf4j-api:1.6.1'
    runtime 'org.slf4j:slf4j-log4j12:1.6.1'
}

test {
    maxParallelForks = 2
}
</pre><h3>\chapter08\execute-test-individually\build.gradle</h3><pre>apply plugin: 'java'

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

sourceCompatibility = 1.7
targetCompatibility = 1.7

ext.omitDatasource = false

repositories {
    mavenCentral()
}

dependencies {
    testCompile 'junit:junit:4.11'
}

task slowTestOnly(type: Test) {
	filter {
		includeTestsMatching 'com.example.*.*Slowly'
	}
}

task testExecutionWithoutSlowTest(type: Test) {
	useJUnit {
	    excludeCategories 'com.example.suite.categories.SlowTests'
	}
}</pre><h3>\chapter08\jvm-tuning\build.gradle</h3><pre>apply plugin: 'java'

test {
	minHeapSize = '1g'
	maxHeapSize = '1g'
	jvmArgs '-XX:+UseG1GC'
}

task testForHeapEater(type: Test) {
	filter {
    	includeTestsMatching '*UsingHugeHeapTest'
	}
	minHeapSize = '1g'
	maxHeapSize = '1g'
}
</pre><h3>\chapter08\parallel-execution\build.gradle</h3><pre>apply plugin: 'java'

sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
  mavenCentral()
}

dependencies {
  testCompile 'junit:junit:4.11'
}

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

test {
  maxParallelForks = 5
}
</pre><h3>\chapter08\parallel-execution2\build.gradle</h3><pre>apply plugin: 'java'

sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
  mavenCentral()
}

dependencies {
  testCompile 'junit:junit:4.11'
}

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

test {
//  maxParallelForks = 4
  maxParallelForks = 3
  forkEvery = 3
}
</pre><h3>\chapter08\separate-test-by-category\build.gradle</h3><pre>apply plugin: 'java'

sourceCompatibility = 1.7
targetCompatibility = 1.7

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

repositories {
    mavenCentral()
}

dependencies {
    testCompile 'junit:junit:4.11'
}

test {
	exclude '**/*Suite.class'
	useJUnit {
		includeCategories 'com.example.suite.categories.UnitTests'
	}

    reports.html.destination = file("${reports.html.destination}/unit")
    reports.junitXml.destination = file("${reports.junitXml.destination}/unit")
}

task integrationTest(type: Test) {
	exclude '**/*Suite.class'
	useJUnit {
		includeCategories 'com.example.suite.categories.IntegrationTests'
    }

    reports.html.destination = file("${reports.html.destination}/integration")
    reports.junitXml.destination = file("${reports.junitXml.destination}/integration")
}
</pre><h3>\chapter08\separate-test-by-filter\build.gradle</h3><pre>apply plugin: 'java'

sourceCompatibility = 1.7
targetCompatibility = 1.7

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

repositories {
    mavenCentral()
}

dependencies {
    testCompile 'junit:junit:4.11'
}

test {
	filter {
		includeTestsMatching '*UT'
	}
	reports.html.destination = file("${reports.html.destination}/unit")
	reports.junitXml.destination = file("${reports.junitXml.destination}/unit")
}

task integrationTest(type: Test) {
	filter {
		includeTestsMatching '*IT'
	}
	reports.html.destination = file("${reports.html.destination}/integration")
	reports.junitXml.destination = file("${reports.junitXml.destination}/integration")
}
</pre><h3>\chapter08\separate-test-by-name\build.gradle</h3><pre>apply plugin: 'java'

sourceCompatibility = 1.7
targetCompatibility = 1.7

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

repositories {
    mavenCentral()
}

dependencies {
    testCompile 'junit:junit:4.11'
}

test {
    exclude '**/*IT.class'

    reports.html.destination = file("${reports.html.destination}/unit")
    reports.junitXml.destination = file("${reports.junitXml.destination}/unit")
}

task integrationTest(type: Test) {
    include '**/*IT.class'

    reports.html.destination = file("${reports.html.destination}/integration")
    reports.junitXml.destination = file("${reports.junitXml.destination}/integration")
}
</pre><h3>\chapter08\separate-test-by-sourceset\build.gradle</h3><pre>apply plugin: 'java'

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
    mavenCentral()
}

dependencies {
    testCompile 'junit:junit:4.11'
}

sourceSets {
	integrationTest {
	    java.srcDir file('src/integrationTest/java')
	    compileClasspath = sourceSets.main.output + configurations.testCompile
	    runtimeClasspath = compileClasspath + output
	}
}

test {
	reports.html.destination = file("${reports.html.destination}/unit")
	reports.junitXml.destination = file("${reports.junitXml.destination}/unit")
}

task integrationTest(type: Test) {
    testClassesDir = sourceSets.integrationTest.output.classesDir
    classpath = sourceSets.integrationTest.runtimeClasspath
    
    // for report
    reports.html.destination = file("${reports.html.destination}/integration")
    reports.junitXml.destination = file("${reports.junitXml.destination}/integration")
}
</pre><h3>\chapter08\separate-test-by-suite\build.gradle</h3><pre>apply plugin: 'java'

sourceCompatibility = 1.7
targetCompatibility = 1.7

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

repositories {
    mavenCentral()
}

dependencies {
    testCompile 'junit:junit:4.11'
	testCompile 'org.mockito:mockito-core:1.9.5'
}

test {
	include '**/UnitTestSuite.class'

    reports.html.destination = file("${reports.html.destination}/unit")
    reports.junitXml.destination = file("${reports.junitXml.destination}/unit")
}

task integrationTest(type: Test) {
	include '**/IntegrationTestSuite.class'

    reports.html.destination = file("${reports.html.destination}/integration")
    reports.junitXml.destination = file("${reports.junitXml.destination}/integration")
}

task smokeTest(type: Test) {
	include '**/SmokeTestSuite.class'

    reports.html.destination = file("${reports.html.destination}/smoke")
    reports.junitXml.destination = file("${reports.junitXml.destination}/smoke")
}</pre><h3>\chapter08\switch-env-by-gradle\build.gradle</h3><pre>apply from: "environments/${env}/env.gradle"

task showURL << {
  println "App Server: ${app_url}"
}</pre><h3>\chapter08\switch-env-by-gradle\environments\dev\env.gradle</h3><pre>ext.app_url = 'localhost'</pre><h3>\chapter08\switch-env-by-gradle\environments\production\env.gradle</h3><pre>ext.app_url = 'xxx.xxx.xxx.xxx'</pre><h3>\chapter08\switch-env-by-group\build.gradle</h3><pre>task showURL << {
  def url = new File('config/env.conf').toURL()
  def config = new ConfigSlurper("$env").parse(url)
  println 'App Server: ' + config.app_url
}</pre><h3>\chapter08\switch-env-by-properties\build.gradle</h3><pre>// load from properties file.
task showURL << {
  def props = new Properties()
  props.load(new FileInputStream("environments/${env}/env.properties"))
  println "App Server: ${props.app_url}"
}
</pre><h3>\chapter08\switch-env-by-properties\environments\dev\env.properties</h3><pre>app_url=localhost</pre><h3>\chapter08\switch-env-by-properties\environments\production\env.properties</h3><pre>app_url=xxx.xxx.xxx.xxx</pre><h3>\chapter08\test-logging-control\build.gradle</h3><pre>apply plugin: 'java'

sourceCompatibility = 1.7
targetCompatibility = 1.7

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

repositories {
	mavenCentral()
}

dependencies {
	compile 'org.slf4j:slf4j-api:1.7.7'
	testCompile 'junit:junit:4.11'
	runtime 'ch.qos.logback:logback-classic:1.1.2'
}

test {
    filter {
        includeTestsMatching '*succeed*'
    }
    testLogging {
        showStandardStreams = true
        events 'started', 'skipped', 'failed'
        displayGranularity = 1
    }
}
</pre><h3>\chapter08\test-logging-control\displayGranularity.gradle</h3><pre>apply plugin: 'java'
apply plugin: 'eclipse'

sourceCompatibility = 1.7
targetCompatibility = 1.7

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.slf4j:slf4j-api:1.7.7'
    testCompile 'junit:junit:4.11'
    runtime 'ch.qos.logback:logback-classic:1.1.2'
}

test {
    filter {
        includeTestsMatching '*succeed*'
    }
    testLogging {
        events 'started', 'skipped', 'failed'
        displayGranularity = 1
    }
}

task suiteTest(type: Test) {
    include '**/*Suite.class'

    testLogging {
        events 'started', 'skipped', 'failed'
        displayGranularity = 0
    }
    reports.html.destination = file("${reports.html.destination}/suite")
    reports.junitXml.destination = file("${reports.junitXml.destination}/suite")
}</pre><h3>\chapter08\test-logging-control\normal.gradle</h3><pre>apply plugin: 'java'

sourceCompatibility = 1.7
targetCompatibility = 1.7

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.slf4j:slf4j-api:1.7.7'
    testCompile 'junit:junit:4.11'
    runtime 'ch.qos.logback:logback-classic:1.1.2'
}

test {
    // nothing
}
</pre><h3>\chapter08\test-logging-control\showEvents.gradle</h3><pre>apply plugin: 'java'

sourceCompatibility = 1.7
targetCompatibility = 1.7

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.slf4j:slf4j-api:1.7.7'
    testCompile 'junit:junit:4.11'
    runtime 'ch.qos.logback:logback-classic:1.1.2'
}

test {
    testLogging {
        events 'started', 'skipped', 'failed'
    }
}
</pre><h3>\chapter08\test-logging-control\showStandardStreams.gradle</h3><pre>apply plugin: 'java'

sourceCompatibility = 1.7
targetCompatibility = 1.7

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava]*.options*.encoding = defaultEncoding

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.slf4j:slf4j-api:1.7.7'
    testCompile 'junit:junit:4.11'
    runtime 'ch.qos.logback:logback-classic:1.1.2'
}

test {
    filter {
        includeTestsMatching '*succeed*'
    }
    testLogging {
        showStandardStreams = true
    }
}
</pre><h3>\chapter08\test-report-control\build.gradle</h3><pre>apply plugin: 'java'
apply plugin: 'eclipse'

sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.slf4j:slf4j-api:1.7.7'
    testCompile 'junit:junit:4.11'
    runtime 'ch.qos.logback:logback-classic:1.1.2'
}

sourceSets {
    sub {
        java.srcDir file('src/sub/java')
        compileClasspath = configurations.compile
    }
    subTest {
        java.srcDir file('src/subTest/java')
        compileClasspath = sourceSets.sub.output + configurations.testCompile
        runtimeClasspath = output + compileClasspath + configurations.testRuntime
    }
}

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava, compileSubJava, compileSubTestJava]*.options*.encoding = defaultEncoding

test {
    description = 'src/main/java에 대한 테스트를 실행한다'

    reports.html.destination = file("$reports.html.destination/unit-main")
    reports.junitXml.destination = file("$reports.junitXml.destination/unit-main")
}

task subTest(type: Test) {
    description = 'src/sub/java에 대한 테스트를 실행한다'
    group = 'verification'
    
    testClassesDir = sourceSets.subTest.output.classesDir
    classpath = sourceSets.subTest.runtimeClasspath

    reports.html.destination = file("$reports.html.destination/unit-sub")
    reports.junitXml.destination = file("$reports.junitXml.destination/unit-sub")
}

task summaryTestReports(type: TestReport, dependsOn: [test, subTest]) {
    destinationDir = file("$buildDir/reports/tests/unit-summary")
    reportOn test, subTest
}

check.dependsOn summaryTestReports</pre><h3>\chapter08\test-report-control\summaryOnly.gradle</h3><pre>apply plugin: 'java'
apply plugin: 'eclipse'

sourceCompatibility = 1.7
targetCompatibility = 1.7

repositories {
    mavenCentral()
}

dependencies {
    compile 'org.slf4j:slf4j-api:1.7.7'
    testCompile 'junit:junit:4.11'
    runtime 'ch.qos.logback:logback-classic:1.1.2'
}

sourceSets {
    sub {
        java.srcDir file('src/sub/java')
        compileClasspath = configurations.compile
    }
    subTest {
        java.srcDir file('src/subTest/java')
        compileClasspath = sourceSets.sub.output + configurations.testCompile
        runtimeClasspath = output + compileClasspath + configurations.testRuntime
    }
}

def defaultEncoding = 'UTF-8'
[compileJava, compileTestJava, compileSubJava, compileSubTestJava]*.options*.encoding = defaultEncoding

test {
    description = 'src/main/javaに対するテストを実行します'

    reports.html.enabled = false
	
    /* 出力先の指定が残っていても問題ないが、不要なので削除しておく */
    reports.junitXml.destination = file("$reports.junitXml.destination/unit-main")
}

task subTest(type: Test) {
    description = 'src/sub/javaに対するテストを実行します'
    group = 'verification'
    
    testClassesDir = sourceSets.subTest.output.classesDir
    classpath = sourceSets.subTest.runtimeClasspath

    reports.html.enabled = false

    /* 出力先の指定が残っていても問題ないが、不要なので削除しておく */
    reports.junitXml.destination = file("$reports.junitXml.destination/unit-sub")
}

task summaryTestReports(type: TestReport, dependsOn: [test, subTest]) {
    destinationDir = file("$buildDir/reports/tests/unit-summary")
    reportOn test, subTest
}

check.dependsOn summaryTestReports</pre><h3>\chapter11\gradle-jenkins\build.gradle</h3><pre>apply plugin: 'java'
apply plugin: 'checkstyle'
apply plugin: 'findbugs'
apply plugin: 'jacoco'

repositories {
  mavenCentral()
}

dependencies {
  testCompile 'junit:junit:4.11'
}

archivesBaseName = 'gradle-jenkins-sample'

[checkstyle, findbugs]*.ignoreFailures = true

findbugs {
  // JDK8를 사용하는 경우 FindBugs2.x가 동작하지 않기 때문에
  // 명시적으로 FindBugs3.0.0을 지정해두도록 한다
  toolVersion = '3.0.0'
}

task checkstyleTest(overwrite: true) << {}
task findbugsTest(overwrite: true) << {}
</pre><h3>\chapter12\archive-name\build.gradle</h3><pre>task docsZip(type: Zip) {
  // <프로젝트 디렉터리>/build/project-docs.zip로 생성
  destinationDir = file("build")
  archiveName = "project-docs.zip"
  appendix = "docs"
  classifier = "jdk15"

  from ("src/dist") {
    include "**/*.html", "**/*.css", "**/*.js"
  }
}
</pre><h3>\chapter12\archive-path-basename\build.gradle</h3><pre>task docsZip(type: Zip) {
  // <프로젝트 디렉터리/project.zip로 생성
  baseName = "project"
  from ("src/dist") {
    include "**/*.html", "**/*.css", "**/*.js"
  }
}

</pre><h3>\chapter12\archive-path-partial\build.gradle</h3><pre>task docsZip(type: Zip) {
  // <프로젝트 디렉터리>/build/docs-jdk15.zip 로 생성
  destinationDir = file("build")
  appendix = "docs"
  classifier = "jdk15"

  from ("src/dist") {
    include "**/*.html", "**/*.css", "**/*.js"
  }
}

</pre><h3>\chapter12\base-plugin-archives\build.gradle</h3><pre>// base-plugin-archives/build.gradle

version = 1.0

apply plugin: "base"

task docsZip(type: Zip) {
 // ...
}

task printArchiveInfo << {
  println docsZip.destinationDir
  println docsZip.baseName
  println docsZip.version
  println docsZip.archivePath
}

</pre><h3>\chapter12\configure-repositories\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "maven-publish" // Maven Publish 플러그인 적용

//..

group = "com.example"
version = 0.1

repositories {
  mavenCentral()
}

dependencies {
  runtime "org.apache.commons:commons-lang3:3.3.1"
}

task sourceJar(type: Jar) {
  from sourceSets.main.allJava // 소스 세트를 입력 파일로 지정
}

publishing { // 공개 설정
  publications {
    mod1(MavenPublication) { // <mod1>는 임의의 모듈 식별명
      from components.java // 소프트웨어 컴포넌트 'java'를 공개 대상으로 지정
      // artifact() 메서드로 공개할 압축 파일이나 파일을 지정
      artifact sourceJar {
        classifier "sources"
      }
    }
  }

  repositories {
    maven {
      name "local1" // 리포지토리명. 생략한 경우는 'maven'」
      url "build/repo1" // 디렉터리 지정
    }
    maven {
      name "remote1" // 리포지토리명. 생략한 경우는 ''maven'」
      url "http://localhost:8081/artifactory/repo1" // 리포지토리의 URL
    }
  }
}

</pre><h3>\chapter12\custom-ivy-file\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "ivy-publish"

group = "com.example"
version = 0.1

// ...

repositories {
  mavenCentral()
}

dependencies {
  runtime "org.apache.commons:commons-lang3:3.3.1"
}

publishing { // 공개 설정
  publications {
    mod1(IvyPublication) {
      from components.java
      module = "my-maven-mod1" // 미지정인 경우는 project.name 이 사용된다
      organisation = "com.example.maven" // 미지정인 경우는 project.group이 사용된다
      revision = "0.1-a" // 미지정인 경우는 project.version이 사용된다

      descriptor.withXml { xml ->
        final infoNode = xml.asNode().info[0]
        final licenseNode = {
          license {
            name "The Apache Software License, Version 2.0"
            url "http://www.apache.org/licenses/LICENSE-2.0.txt"
          }
        }
        licenseNode.resolveStrategy = Closure.DELEGATE_FIRST

        infoNode.appendNode("description", "샘플 프로젝트 버전 $version")
        infoNode.description + licenseNode
      }
    }
  }
}

</pre><h3>\chapter12\custom-pom\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "maven-publish"

group = "com.example"
version = 0.1

// ...

repositories {
  mavenCentral()
}

dependencies {
  runtime "org.apache.commons:commons-lang3:3.3.1"
}

publishing { // 공개 설정
  publications {
    mod1(MavenPublication) {
      from components.java
      artifactId = "my-maven-mod1" // 미지정인 경우는 project.name 이 사용된다
      groupId = "com.example.maven" // 미지정인 경우는 project.group이 사용된다
      version = "0.1-a" // 미지정인 경우는 project.version이 사용된다

      pom.withXml { xml ->
        final myPom = {
          packaging "jar"
          nama "My Sample Project"
          description "샘플 프로젝트 버전 $version"
          licenses {
            license {
              name "The Apache Software License, Version 2.0"
              url "http://www.apache.org/licenses/LICENSE-2.0.txt"
              distribution "repo"
            }
          }
        }
        // description 등 프로젝트 속성을 덮어쓰기한 경우 대책
        myPom.resolveStrategy = Closure.DELEGATE_FIRST

        xml.asNode().children().last() + myPom
      }
    }
  }
}

</pre><h3>\chapter12\filter-on-zipping\build.gradle</h3><pre>version = 1.0

task docsZip(type: Zip) {
  from 'docs'
  into 'userguide'
  include '**/*.html', '**/*.css'

  final date = new Date()
  filter { line ->
    line.replaceAll(/@date@/, date.format('yyyyMMddHHmm'))
  }

  filter org.apache.tools.ant.filters.TabsToSpaces, tablength: 4

  expand version: project.version
}

</pre><h3>\chapter12\global-exclusion\build.gradle</h3><pre>// 기본 제외 설정에서 삭제한다
org.apache.tools.ant.DirectoryScanner.removeDefaultExclude("**/.gitignore")

task projectZip(type: Zip) {
  // 프로젝트 디렉터리를 압축한다
  from (".")
  include "**/.gitignore", "**/*.java", "**/*.html"
  exclude ".gradle"
}

</pre><h3>\chapter12\jar-archives\build.gradle</h3><pre>version = 1.0

task sourcesJar(type: Jar) {
  // 태스크 설정(jar 파일 생성 위치 등)
  baseName = "my-library"
  appendix = "sources"
  destinationDir = file("build")

  // 압축 구성
  from("src/main/java") {
    include "**/*.java", "**/*.groovy", "**/*.xml"
  }
  // 매니페스트 설정
  manifest {
    attributes("Built-By": "Gradle", "Implementation-Version": project.version)
  }
}
</pre><h3>\chapter12\my-bintray-module\build.gradle</h3><pre>buildscript {
  repositories {
    jcenter()
 }
 dependencies {
   // bintray 플러그인을 사용할 수 있게 한다
   classpath "com.jfrog.bintray.gradle:gradle-bintray-plugin:0.5"
 }
}

apply plugin: "com.jfrog.bintray" // bintray 플러그인 적용

apply plugin: "java"
apply plugin: "maven-publish"

group = "com.example"
version = 0.1

repositories {
  mavenCentral()
}

dependencies {
  compile "org.apache.commons:commons-lang3:3.3.1"
}

task sourceJar(type: Jar) {
  from sourceSets.main.allJava // 소스 세트를 입력 파일로 설정
}

publishing {
  publications {
    mod1(MavenPublication) { // 모듈 정의 
      artifactId "my-bintray-module"

      from components.java // 소프트웨어 컴포넌트 'java'를 공개 대상으로 지정
      // artifact() 메서드로 공개할 압축 파일이나 파일을 지정
      artifact sourceJar {
        classifier "sources"
      }
    }
  }
}

bintray {
  user = project.has("bintrayUser") ? bintrayUser : "" // Bintray アカウント名
  key = project.has("bintrayKey") ? bintrayKey : "" // Bintray APIキー
  publications = ["mod1"] // Bintray에 업로드하는 모듈
  publish = true
  pkg {  // 업로드 위치의 Bintray 패키지 정보
    repo = "test1"
    name = "my-pkg"
  }
}

</pre><h3>\chapter12\my-bintray-module\gradle.properties</h3><pre>bintrayUser=gradle-book
bintrayKey=

</pre><h3>\chapter12\my-bintray-module-client\build.gradle</h3><pre>apply plugin: "application"
mainClassName = "com.example.Client"

apply plugin: "java"

repositories {
  // com.example:my-bintray-module:0.1의 의존 라이브러리 취득 위치
  jcenter()

  // com.example:my-bintray-module:0.1을 취득하는 위치
  maven {
    // http://dl.bintray.com/<계정명>/<리포지토리명>
    url "http://dl.bintray.com/gradle-book/test1"
  }
}

dependencies {
  compile "com.example:my-bintray-module:0.1"
}

</pre><h3>\chapter12\my-maven-central-module\build.gradle</h3><pre>buildscript {
  repositories {
    jcenter()
  }
  dependencies {
    classpath 'com.jfrog.bintray.gradle:gradle-bintray-plugin:0.5'
  }
}

import groovyx.net.http.HTTPBuilder
import static groovyx.net.http.ContentType.*
import static groovyx.net.http.Method.*

version = "0.1"
group = "com.example.gradle.maven"

apply plugin: "java"
apply plugin: 'maven-publish'
apply plugin: "com.jfrog.bintray"

task sourcesJar(type: Jar) { // 코드의 JAR 작성 태스크
  from sourceSets.main.allJava // 소스 세트를 입력 파일로 설정
}
  classifier = "sources"
}

task javadocJar(type: Jar, dependsOn: javadoc) { // Javadoc JAR의 작성 태스크
  classifier 'javadoc'
  from javadoc.destinationDir // Javadoc의 대상 디렉터리를 입력 파일로 지정
}

jar.dependsOn sourcesJar, javadocJar // jar 태스크 실행 시에 코드 JAR와 Javadoc JAR도 작성한다

// Bintray의 REST API를 이용해서 업로드한 모듈에 서명하는 태스크
task signBintrayPackage << {
  final http = new HTTPBuilder(bintray.apiUrl) // 「bintray」는 빈트레이 플러그인에 의해 설정되는 속성

  // BASIC 인증
  http.auth.basic bintrayUser, bintrayKey

  // Bintray의 REST API 요청
  http.request(POST, JSON) {
    uri.path = "/gpg/${bintrayUser}/${bintray.pkg.repo}/${bintray.pkg.name}/versions/${project.version}"
    body = [passphrase: signKeyPassphrase]
    response.success = { resp ->
      logger.info("Signed version ${project.version}.")
    }
    response.failure = { resp ->
      throw new GradleException("Could not sign version ${project.version}: $resp.statusLine")
    }
  }
}

publishing {
  publications {
    mod1(MavenPublication) {
      from components.java
      artifact sourcesJar // 코드 JAR를 모듈에 포함한다
      artifact javadocJar // Javadoc JAR를 모듈에 포함한다

      final customPom = { // Maven Central 리포지토리가 요구하는 POM
        packaging "jar"
        name "Gradle XXX Plugin"
        url "https://example.com/module-site/xxx"
        description "This is a sample module for mvn central."
        licenses {
          license {
            name "The Apache Software License, Version 2.0"
            url "http://www.apache.org/licenses/LICENSE-2.0.txt"
            distribution "repo"
          }
        }
        scm {
          url "https://github.com/xxx/xxx"
          connection "https://github.com/xxx/xxx"
        }
        developers {
          developer {
            id "my-name-id"
            name "Taro Gradle"
            email "xxx@example.com"
          }
        }
      }
      customPom.resolveStrategy = Closure.DELEGATE_FIRST

      pom.withXml { xml ->
        final root = xml.asNode()
        root.children().last() + customPom
      }
    }
  }
}

bintray {
  user = bintrayUser
  key = bintrayKey
  publications = ["mod1"]
  pkg {
    repo = "test1"
    name = "my-pkg-2"
  }
}

</pre><h3>\chapter12\my-maven-central-module\gradle.properties</h3><pre>bintrayUser=gradle-book
bintrayKey=
signKeyPassphrase=

</pre><h3>\chapter12\nested-copyspec\build.gradle</h3><pre>task docsZip(type: Zip) {
  // 압축한 것을 docs-1 디렉터리에 추가한다
  into "docs-1"
  // base.css를 압축 대상으로 한다
  include "**/base.css"
  // 빈 디렉터리는 제외한다
  includeEmptyDirs = false

  // 압축한 것을 release-note 디렉터리에 추가한다
  into("release-notes") {
    // docs 디렉터리로부터
    from "docs"
    // release-note.html를 압축한다
    include "release-note.html"
  }

  // 압축한 것을 userguide 디렉터리에 추가
  into("userguide") {
    // docs 디렉터리의
    from("docs") {
      // HTML 파일을 압축한다
      include "**/*.html"
      // 단, 출시 안내서는 이 디렉터리에 포함하지 않는다
      exclude "release-note.html"
    }
    // sample 디렉터리의
    from("sample") {
      // Java 파일을 압축한다
      include "**/*.java"
    }
  }
}

</pre><h3>\chapter12\publications-ivy-for-softwarecomponent\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "ivy-publish" // Ivy Publish 플러그인 적용

// ...

group = "com.example"
version = 0.1

repositories {
  mavenCentral()
}

dependencies {
  runtime "org.apache.commons:commons-lang3:3.3.1"
}

publishing { // 공개 설정
  publications {
    mod1(IvyPublication) { // <mod1>는 임의의 모듈 식별명
      from components.java // 소프트웨어 컴포넌트 'java'를 공개 대상으로 지정
    }
  }
}

</pre><h3>\chapter12\publications-maven-for-softwarecomponent\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "maven-publish" // Ivy 리포지토리에 공개하는 경우는 ivy-publish를 적용

group = "com.example"
version = 0.1

repositories {
  mavenCentral()
}

dependencies {
  runtime "org.apache.commons:commons-lang3:3.3.1"
}

publishing { // 공개 설정
  publications {
    mod1(MavenPublication) { // <mod1>는 임의의 모듈 식별명. 아이비의 경우는 IvyPublication
      from components.java // 소프트웨어 컴포넌트 'java'를 모듈에 등록
    }
  }
}

</pre><h3>\chapter12\publishing-artifacts\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "maven-publish" // Ivy 리포지토리에 공개하는 경우는 ivy-publish 적용

//...

group = "com.example"
version = 0.1

repositories {
  mavenCentral()
}

dependencies {
  runtime "org.apache.commons:commons-lang3:3.3.1"
}

task sourceJar(type: Jar) {
  classifier 'sources'
  from sourceSets.main.allJava // 소스 세트를 입력 파일로 지정
}
task javadocJar(type: Jar, dependsOn: javadoc) {
  classifier 'javadoc'
  from javadoc.destinationDir // Javadoc의 대상 디렉터리를 입력 파일로 지정
}

publishing {
  publications {
    mod1(MavenPublication) { // <mod1>는 임의의 모듈 식별명
      from components.java // 소프트웨어 컴포넌트 'java'를 공개 대상으로 지정
      // artifact() 메서드로 공개할 압축 파일이나 파일을 지정
      artifact(sourceJar) // 태스크명을 지정하면 해당 태스크에 의해 출력 파일이 공개된다
      artifact(javadocJar)
    }
  }
}

</pre><h3>\chapter12\publishing-files\build.gradle</h3><pre>apply plugin: "maven-publish" // Maven Publish 플러그인 적용

group = "com.example"
version = 0.1

publishing {
  publications {
    docs(MavenPublication) {
      artifactId 'project-docs-list'  // 미설정인 경우는 project.name 이 사용된다
      artifact('my-docs-index.htm') { // artifact() 메서드로 파일을 직접 아티팩트로 설정
        extension 'html'
      }
    }
  }
}

</pre><h3>\chapter12\publishing-ivy-artifacts\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "ivy-publish" // Ivy Publish 플러그인 적용

//...

group = "com.example"
version = 0.1

repositories {
  mavenCentral()
}

dependencies {
  runtime "org.apache.commons:commons-lang3:3.3.1"
}

task sourceJar(type: Jar) {
  classifier 'sources'
  from sourceSets.main.allJava // 소스 세트를 입력 파일로 지정
}
task javadocJar(type: Jar, dependsOn: javadoc) {
  classifier 'javadoc'
  from javadoc.destinationDir
}

publishing {
  publications {
    mod1(IvyPublication) { // <mod1>는 임의의 모듈 식별명
      from components.java // 소프트웨어 컴포넌트 'java'를 공개 대상으로 지정
      // artifact() 메서드로 공개할 압축 파일이나 파일을 지정
      artifact(sourceJar) { // 태스크명을 지정하면 해당 태스크에 의해 출력 파일이 공개된다
        type 'source'
      }
      artifact(javadocJar) {
        type 'doc'
      }
    }
  }
}

</pre><h3>\chapter12\publishing-maven-repository\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "maven-publish" // maven-publish 플러그인 적용
apply plugin: "ivy-publish" // ivy-publish 플러그인 적용

//...

group = "com.example"
version = 0.1

repositories {
  mavenCentral()
}

dependencies {
  runtime "org.apache.commons:commons-lang3:3.3.1"
}

task sourceJar(type: Jar) {
  classifier 'sources'
  from sourceSets.main.allJava // 소스 세트를 입력 파일로 지정
}
task javadocJar(type: Jar, dependsOn: javadoc) {
  classifier 'javadoc'
  from javadoc.destinationDir
}

publishing {
  publications {
    pub1(IvyPublication) { // <pub1>는 임의의 공개명
      from components.java // 소프트웨어 컴포넌트 'java'를 공개 대상으로 지정
      // artifact() 메서드로 공개할 압축 파일이나 파일을 지정
      artifact(sourceJar) // 태스크명을 지정하면 해당 태스크에 의해 출력 파일이 공개된다
      artifact(javadocJar)
    }
  }
  repositories {
    ivy {
      url "sftp://localhost:22/tmp/repository"
      credentials {
        username 'masatoshi_hayashi'
        password 'D1ddlddl'
      }
    }
  }
}

</pre><h3>\chapter12\rename-files\build.gradle</h3><pre>final docTheme = "BLUE"

task docsZip(type: Zip) {
  into("userguide") {
    from("docs") {
      include "**/*.html", "**/*.css"
      rename { originalName ->
        if (originalName == "release-note.html")
            return "release-note-${new Date().format('yyyyMMddHHmm')}.html"
      }
      rename(/THEME_${docTheme}-(.*\.css)/, '$1')
    }
  }
}
</pre><h3>\chapter12\sftp-repository\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "ivy-publish" // Ivy Publish 플러그인 적용

//..

group = "com.example"
version = 0.1

repositories {
  mavenCentral()
}

dependencies {
  runtime "org.apache.commons:commons-lang3:3.3.1"
}

task sourceJar(type: Jar) {
  from sourceSets.main.allJava // 소스 세트를 입력 파일로 지정
}

publishing { // 공개 설정
  publications {
    mod1(IvyPublication) { // <mod1>는 임의의 모듈 식별명
      from components.java // 소프트웨어 컴포넌트 'java'를 공개 대상으로 지정
      // artifact() 메서드로 공개할 압축 파일이나 파일을 지정
      artifact sourceJar {
        classifier "sources"
      }
    }
  }

  repositories {
    ivy {
      credentials {
        username 'my-name'
        password 'xxxxxx'
      }
      url "sftp://localhost:22/tmp/repo1" // sftp 형식으로 리포지토리 정의
    }
  }
}

</pre><h3>\chapter12\simple-from-archive\build.gradle</h3><pre>task docsZip(type: Zip) {
  // docs 디렉터리에서 압축에 포함할 파일을 가져온다
  from "docs"
  // 압축할 파일은 CSS 파일과 HTML 파일
  include "**/*.css", "**/*.html"
  // docs/single.html는 포함하지 않는다
  exclude "single.html"
  // 빈 디렉터리는 포함하지 않는다
  includeEmptyDirs = false
}

</pre><h3>\chapter12\simple-from-archive-into\build.gradle</h3><pre>task docsZip(type: Zip) {
  // docs 디렉터리에서 압축할 파일을 가져온다
  from "docs"
  // 압축 파일 내의 userguide 디렉터리에 압축할 파일을 추가한다
  into "userguide"
  // 압축할 파일은 css 파일과 html 파일
  include "**/*.css", "**/*.html"
  // docs/single.html는 제외한다
  exclude "single.html"
  // 빈 디렉터리는 제외한다
  includeEmptyDirs = false
}

</pre><h3>\chapter12\software-comp-java\build.gradle</h3><pre>apply plugin: "java"

repositories {
  mavenCentral()
}

dependencies {
  runtime "org.apache.commons:commons-lang3:3.3.1"
}

task showSoftwareComponent << {
  // 소프트웨어 컴포넌트 'java'의 정보 출력

  println "---Artifacts---"
  for (a in components.java.usages.artifacts) {
    println a.file //-> <프로젝트>/build/libs/<프로젝트명>.jar
  }

  println "---Dependencies---"
  for (d in components.java.usages.dependencies) {
    println d //-> "org.apache.commons:commons-lang3:3.3.1" 관련 정보
  }
}

</pre><h3>\chapter12\tar-archives\build.gradle</h3><pre>task docsTar(type: Tar) {
  baseName = "project-docs"
  compression = Compression.BZIP2 // 압축 방식 설정

  // 압축 구성
  into ("docs") {
    from (zipTree("src/dist/embedded.zip")) {
      include "**/*.html", "**/*.css", "**/*.js"
    }
    from ("src/dist") {
      include "**/*.html", "**/*.css", "**/*.js"
    }
  }
}

</pre><h3>\chapter12\war-archives\build.gradle</h3><pre>version = 1.0

task myWar(type: War) {
    // 태스크 설정(파일 생성 위치 등)
    baseName = "my-war"
    destinationDir = file("build")

    // 압축 구성
    from("webapp") {
      include "**/*.html", "**/*.js", "**/*.css"
    }
    // 라이브러리 JAR 설정
    classpath fileTree("lib")
    // WEB-INF 구성
    webInf {
      into("classes") {
        from ("out") {
          include "**/*.class"
        }
      }
    }

    webXml file("web.xml")

    manifest {
     attributes("Built-By": "Gradle", "Implementation-Version": project.version)
   }
}

</pre><h3>\chapter12\zip-archives\build.gradle</h3><pre>task docsZip(type: Zip) {
  // 태스크 설정(zip 파일 생성 위치, 압축 레벨 등)
  baseName = "project-docs"
  entryCompression = ZipEntryCompression.STORED

  // 압축 구성
  // 'docs'에 'src/dist' 디렉터리와 embedded.zip의 html, css, js 파일을 모두 추가
  into ("docs") {
    from (zipTree("src/dist/embedded.zip")) {
      include "**/*.html", "**/*.css", "**/*.js"
    }
    from ("src/dist") {
      include "**/*.html", "**/*.css", "**/*.js"
    }
  }
}

</pre><h3>\chapter13\build-comparing-basic\build.gradle</h3><pre>// 빌드 비교 플러그인 적용
apply plugin: 'compare-gradle-builds'

compareGradleBuilds { // 빌드 비교 플러그인 설정 블록
  sourceBuild { // 비교 원본 빌드
    projectDir "project-a" // 빌드의 루트 디렉터리
    gradleVersion "1.12"   // 빌드에 사용하는 그래들 버전
  }
  targetBuild { // 비교 대상 빌드
    projectDir "project-b" // 빌드의 루트 디렉터리
    gradleVersion "2.0"    // 빌드에 사용하는 그래들 버전
  }
}

</pre><h3>\chapter13\build-comparing-basic\project-a\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "application"

version = 1.0

mainClassName = "com.example.Hello"

</pre><h3>\chapter13\build-comparing-basic\project-b\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "application"

version = 1.1

mainClassName = "com.example.Hello"

</pre><h3>\chapter13\build-comparing-tar\build.gradle</h3><pre>// 빌드 비교 플러그인 적용
apply plugin: 'compare-gradle-builds'

compareGradleBuilds { // 빌드 비교 플러그인 설정 블록
  sourceBuild { // 비교 기준 빌드
    projectDir = "source-build" // 빌드의 루트 디렉터리
    gradleVersion = "1.12"   //  빌드에 사용하는 그래들 버전
    tasks = ["docsTar"] // 빌드로 실행하는 태스크
    arguments = ["-PdocsVersion=0.2"] // 빌드 시 커맨드라인 인수
  }
  targetBuild { // 比較先ビルド(ターゲットビルド)
    projectDir = "source-build" // 빌드의 루트 디렉터리
    gradleVersion = "2.0"    //  빌드에 사용하는 그래들 버전
    tasks = ["docsTar"] // 빌드로 실행하는 태스크
    arguments = ["-PdocsVersion=0.2"] // 빌드 시 커맨드라인 인수
  }
}

</pre><h3>\chapter13\build-comparing-tar\source-build\build.gradle</h3><pre>configurations {
  archives
}

task docsTar(type: Tar) {
  baseName "project-doc-${docsVersion}"
  from "docs"
}

artifacts {
  archives docsTar
}

</pre><h3>\chapter13\build-comparing-version\build.gradle</h3><pre>apply plugin: "java"
apply plugin: "compare-gradle-builds"

// 중략

apply plugin: "application"

version = 1.0

mainClassName = "com.example.Hello"

compareGradleBuilds {
  targetBuild {
    gradleVersion "2.0"
  }
}

</pre><h3>\chapter13\build-comparing-zip\build.gradle</h3><pre>// 빌드 비교 플러그인 적용
apply plugin: 'compare-gradle-builds'

compareGradleBuilds { // 빌드 비교 플러그인 설정 블록
  sourceBuild { // 비교 원본 빌드(소스 빌드)
    projectDir = "source-build" // 빌드의 루트 디렉터리
    gradleVersion = "1.12"   //빌드에 사용하는 그래들 버전
    tasks = ["docsZip"] // 빌드로 실행하는 태스크
    arguments = ["-PdocsVersion=0.2"] // 빌드 시의 커맨드라인 인수
  }
  targetBuild { // 비교 대상 빌드
    projectDir = "source-build" // 빌드의 루트 디렉터리
    gradleVersion = "2.0"    // 빌드에 사용하는 그래들 버전
    tasks = ["docsZip"] // 빌드로 실행하는 태스크
    arguments = ["-PdocsVersion=0.2"] // 빌드 시의 커맨드라인 인수
  }
}

</pre><h3>\chapter13\build-comparing-zip\source-build\build.gradle</h3><pre>configurations {
  archives
}

task docsZip(type: Zip) {
  baseName "project-doc-${docsVersion}"
  from "docs"
}

artifacts {
  archives docsZip
}

</pre><h3>\chapter13\buildsrc-project\build.gradle</h3><pre>// build.gradle
task run << {
  final greeting = new Greeting(content: "Hello")
  printGreeting(greeting)
}

void printGreeting(Greeting greeting) {
  println "Greeting: $greeting.content"
}

</pre><h3>\chapter13\custom-task\build.gradle</h3><pre>task myTask(type: MyTask) { // 스크립트 평가 단계(Task 객체 작성 시)에 실행
  target = "world"
}

class MyTask extends DefaultTask {
  String target
  MyTask() {
    this << {
      println "Hello, $target!" 스크립트 실행 단계에 실행
    }
  }
}

</pre><h3>\chapter13\custom-task-annotation\build.gradle</h3><pre>task myTask(type: MyTask) { // 스크립트 평가 단계(Task 객체 작성 시)에 실행
  target = "world"
}

class MyTask extends DefaultTask {
  String target

  @TaskAction
  void greet() {
    println "Hello, $target!" // 스크립트 실행 단계에 실행
  }
}

</pre><h3>\chapter13\default-task-project\build.gradle</h3><pre>task myTask(type: DefaultTask) << {
    println "Hello, world!"
}

</pre><h3>\chapter13\default-task-project\settings.gradle</h3><pre>/*
 * This settings file was auto generated by the Gradle buildInit task
 * by 'masatoshi_hayashi' at '14/04/12 20:47' with Gradle 1.11
 *
 * The settings file is used to specify which projects to include in your build.
 * In a single project build this file can be empty or even removed.
 *
 * Detailed information about configuring a multi-project build in Gradle can be found
 * in the user guide at http://gradle.org/docs/1.11/userguide/multi_project_builds.html
 */

/*
// To declare projects as part of a multi-project build use the 'include' method
include 'shared'
include 'api'
include 'services:webservice'
*/

rootProject.name = 'default-task-project'
</pre><h3>\chapter13\extension-object\build.gradle</h3><pre>apply plugin: GreetingPlugin // 사용자 정의 플러그인 적용

greeting { // GreetingPlugin에 의해 추가된 greeting 블록
  message("Hi", "world")
}

 // Plugin을 implement한 사용자 정의 플러그인 클래스
class GreetingPlugin implements Plugin<Project> {
   // 이 플러그인이 적용될 때 호출되는 메서드
  void apply(Project project) {
    // 프로젝트에 greeting extension 추가
    project.extensions.create("greeting", GreetingExtension)
    // 프로젝트에 'greet' 태스크 추가
    project.task("greet") << {
      println "${project.greeting.greeting}, ${project.greeting.target}!"
    }
  }
}

// greeting extension을 표현하는 클래스
class GreetingExtension {
  String greeting
  String target
  void message(greeting, target) {
    this.greeting = greeting
    this.target = target
  }
}

</pre><h3>\chapter13\external-libraries\build.gradle</h3><pre>// build.gradle
buildscript {
  repositories {
    mavenCentral()
  }
  dependencies {
    classpath "org.apache.commons:commons-lang3:3.3.1"
  }
}

import org.apache.commons.lang3.StringUtils

task run << {
  println StringUtils.removeEnd("http://www.gradle.org/", "/")
}

</pre><h3>\chapter13\external-script-plugin\build.gradle</h3><pre>apply from: "https://gist.githubusercontent.com/literalice/639c845fe7ea4b7b6ce0/raw/1c254a53460a0afa3fd64b98662d8eb74a93cf2d/gistfile1.groovy"

task run(dependsOn: "externalTask") << {
  println "task execution is complete."
}

</pre><h3>\chapter13\import-remote-script\build.gradle</h3><pre>apply from: "https://raw.githubusercontent.com/literalice/sample-flying-saucer/master/build.gradle"
</pre><h3>\chapter13\local-libraries\build.gradle</h3><pre>// build.gradle
buildscript {
  repositories {
    flatDir dir: "lib" // lib/mycompany-gradle-tasks-1.0.jar에 라이브러리 배치
  }
  dependencies {
    classpath "com.example:mycompany-gradle-tasks:1.0"
  }
}

apply plugin: "war"

import com.example.mycompany.gradle.tasks.Deploy

task deploy(type: Deploy) {
  description = "사용자 정의 태스크로 War를 배포한다"

  url "http://mycompany-server.example.com"
}

</pre><h3>\chapter13\local-libraries\mycompany-gradle-tasks\build.gradle</h3><pre>apply plugin: 'java'

group = "com.example"
version = "1.0"

repositories {
  mavenCentral()
}

dependencies {
  compile gradleApi()
}

</pre><h3>\chapter13\local-libraries\mycompany-gradle-tasks\settings.gradle</h3><pre>rootProject.name = 'mycompany-gradle-tasks'
</pre><h3>\chapter13\multiproject-injections\build.gradle</h3><pre>// build.gradle 부모 프로젝트

ext {
  prop1 = "root prop" // 부모 프로젝트의 속성
}
project(":child1") { // 자식 프로젝트 child1에 주입
  ext {
    prop3 = "injected child prop" // 속성 주입
  }
  task injectedTask << { // 태스크 주입
    println "from a injected task"
    // 자식 프로젝트 child1의 속성, 부모 프로젝트로부터 상속된 메소드 호출
    printProp(prop2)
  }
}

task run << {
  println "from a root task"
  printProp(prop1)
}

void printProp(String prop) {
  println "Prop: $prop"
}

</pre><h3>\chapter13\multiproject-injections\child1\build.gradle</h3><pre>// child1/build.gradle 자식 프로젝트
ext {
  prop2 = "child prop1"
}

// 부모 프로젝트에서 주입된 태스크를 참조
task run(dependsOn: "injectedTask") << {
  println "from a child task"
  // 부모 프로젝트에서 상속된 메서드, 속성 호출
  printProp(prop1)
  // 부모 프로젝트에서 주입된 속성 호출
  printProp(prop3)
}
</pre><h3>\chapter13\multiproject-injections\settings.gradle</h3><pre>// settings.gradle
include "child1"

</pre><h3>\chapter13\plugin-name\build.gradle</h3><pre>apply plugin: "greeting" // 사용자 정의 플러그인 적용

greeting { // GreetingPlugin에 의해 추가된 greeting 블록
  message("Hi", "world")
}
</pre><h3>\chapter13\plugin-name\buildSrc\src\main\resources\META-INF\gradle-plugins\greeting.properties</h3><pre>implementation-class=GreetingPlugin
</pre><h3>\chapter13\profile-settings\build.gradle</h3><pre>// build.gradle
apply from: "${profile}.gradle"
task run << {
    println serverUrl
}

</pre><h3>\chapter13\profile-settings\development.gradle</h3><pre>// development.gradle
ext {
    serverUrl = "localhost"
}

</pre><h3>\chapter13\profile-settings\production.gradle</h3><pre>// production.gradle
ext {
    serverUrl = "www.example.com"
}

</pre><h3>\chapter13\simple-plugin\build.gradle</h3><pre>// build.gradle

apply plugin: GreetingPlugin // 사용자 정의 플러그인 적용

class GreetingPlugin implements Plugin<Project> { // Plugin을 implement한 사용자 정의 플러그인 클래스
  void apply(Project project) { // 이 플러그인이 적용될 때 호출되는 메서드
    project.task("greet") << { // 프로젝트에 'greet' 태스크 추가
      println "Hello, world!"
    }
  }
}

</pre><h3>\chapter13\test-task\build.gradle</h3><pre>task myTask(type: MyTask) { // 스크립트 평가 단계(Task 객체 작성 시)에 실행
  target = "world"
}
</pre><h3>\chapter14\ant-import-checkstyle\build.gradle</h3><pre>repositories {
    mavenCentral() // Maven Central 리포지토리 사용한다
}

configurations {
    antTasks // 앤트 태스크의 의존 관계를 저장하는 컨피겨레이션
}

dependencies {
    // Checkstyle 라이브러리 의존 관계 선언
    antTasks "com.puppycrawl.tools:checkstyle:5.7"
}

version = "1.1"

ant.importBuild "build.xml"

ant.properties.version = version

task check << {
    // // 컨피겨레이션에서 checkstyle 태스크 읽기
    ant.taskdef(resource: "checkstyletask.properties", classpath: configurations.antTasks.asPath)

    ant.checkstyle(config: "checkstyle/checkstyle.xml") { // checkstyle 태스크 설정
        fileset(dir: ant.properties.src)
        property(key: "checkstyle.cache.file", file: "checkstyle/cache")
        formatter(type: "xml", toFile: "checkstyle/checkstyle_errors.xml")
    }
}

compile.dependsOn check // compile 전에 check 태스크 실행

</pre><h3>\chapter14\ant-import-property-ref\build.gradle</h3><pre>version = "1.1"

ant.importBuild "build.xml"

ant.properties.version = version // build.xml의 version 속성 덮어쓰기

task war(type: War, dependsOn: "jar") { // build.xml의 jar 타깃 참조
    description = "war 파일을 작성"

    baseName = "ant-sample" // war 파일의 이름
    version = project.version // 파일명에 추가되는 버전

    destinationDir = file("dist")// war 파일 출력 위치

    // war 구성
    from("web") {
        include("index.html")
    }
    // build.xml의 속성 참조
    classpath("${ant.properties.dist}/lib/${ant.project.name}-${version}.jar")
    webInf {
        from ("web/WEB-INF")
    }
}
</pre><h3>\chapter14\ant-import-simple\build.gradle</h3><pre>// build.gradle

ant.importBuild "build.xml"

</pre><h3>\chapter14\ant-import-war\build.gradle</h3><pre>version = "1.1"

ant.importBuild "build.xml"

task war(type: War, dependsOn: "jar") { // build.xml의 jar 타깃 참조
    description = "war 파일을 작성"

    baseName = "ant-sample" // war 파일 이름
    version = project.version // 파일명에 추가되는 버전

    destinationDir = file("dist")// war 파일 출력 위치

    // war 파일 구성
    from("web") {
        include("index.html")
    }
    classpath("dist/lib/sample-ant-project-0.1.jar")
    webInf {
        from ("web/WEB-INF")
    }
}
</pre><h3>\chapter14\maven-gradle-transitive-deps\build.gradle</h3><pre>apply plugin: "java"

repositories {
  mavenCentral()
}

dependencies {
  compile('org.codehaus.groovy:groovy-all:2.0.4') {
      // force = true
  }
  testCompile 'org.spockframework:spock-core:0.7-groovy-2.0'
}

task showDeps << {
  configurations.testCompile.each {
    println it.absolutePath
  }
}

</pre><h3>\chapter14\my-maven-project\build.gradle</h3><pre>// 생성되는 build.gradle

apply plugin: 'java'
apply plugin: 'maven'

group = 'com.example' // <- pom.xml의 groupId 요소로부터
version = '1.0-SNAPSHOT' // <- pom.xml의 version 요소로부터

description = """My sample maven project""" // <- pom.xml의 name 요소로부터

sourceCompatibility = 1.5
targetCompatibility = 1.5

repositories {
     maven { url "http://repo.maven.apache.org/maven2" }
}
dependencies {
    testCompile group: 'junit', name: 'junit', version:'3.8.1'
}
</pre><h3>\chapter14\my-maven-project\settings.gradle</h3><pre>// 生成されるsettings.gradle

rootProject.name = 'my-maven-project' // <- pom.xmlのartifactId要素から
</pre><h3>\chapter14\simple-parent\build.gradle</h3><pre>  // 생성되는 build.gradle

allprojects  {
  apply plugin: 'maven'

  group = 'com.example'
  version = '0.1-SNAPSHOT'
}

subprojects {
  apply plugin: 'java'

  sourceCompatibility = 1.5
  targetCompatibility = 1.5

  task packageSources(type: Jar) {
    classifier = 'sources'
    from sourceSets.main.allSource
  }
  artifacts.archives packageSources

  repositories {
    mavenLocal()
    maven { url "http://repo.maven.apache.org/maven2" }
  }
  
  dependencies {
    testCompile group: 'junit', name: 'junit', version:'3.8.1'
  }
}

</pre><h3>\chapter14\simple-parent\settings.gradle</h3><pre>// 生成されるsettings.gradle

rootProject.name = 'simple-parent'
include ':simple-jar'
include ':simple-webapp'

project(':simple-jar').projectDir = "$rootDir/simple-jar" as File
project(':simple-webapp').projectDir = "$rootDir/simple-webapp" as File
</pre><h3>\chapter14\simple-parent\simple-jar\build.gradle</h3><pre>description = 'My multi-mudule simple jar project'

dependencies {
    compile group: 'log4j', name: 'log4j', version:'1.2.14'
    compile group: 'dom4j', name: 'dom4j', version:'1.6.1'
    compile group: 'jaxen', name: 'jaxen', version:'1.1.1'
    compile group: 'velocity', name: 'velocity', version:'1.5'
    testCompile group: 'commons-io', name: 'commons-io', version:'1.3.2'
}

task packageTests(type: Jar) {
  from sourceSets.test.output
  classifier = 'tests'
}
artifacts.archives packageTests
</pre><h3>\chapter14\simple-parent\simple-jar\src\main\resources\log4j.properties</h3><pre># Set root category priority to INFO and its only appender to CONSOLE.
log4j.rootCategory=INFO, CONSOLE

# Set the enterprise logger category to FATAL and its only appender to CONSOLE.
#log4j.logger.org.apache.axis.enterprise=FATAL, CONSOLE

# CONSOLE is set to be a ConsoleAppender using a PatternLayout.
log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender
log4j.appender.CONSOLE.Threshold=INFO
log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout
log4j.appender.CONSOLE.layout.ConversionPattern=%-4r %-5p %c{1} %x - %m%n</pre><h3>\chapter14\simple-parent\simple-webapp\build.gradle</h3><pre>// 생성되는 simple-webapp 프로젝트의 build.gradle

apply plugin: 'war'

description = 'My multi-module simple web application project'

dependencies {
  compile group: 'org.apache.geronimo.specs', name: 'geronimo-servlet_2.4_spec', version:'1.1.1'
  compile project(':simple-jar')
}

</pre><h3>\chapter14\simple-super-pom\my-project\build.gradle</h3><pre>apply plugin: 'java'
apply plugin: 'maven'

group = 'com.example'
version = '2.0'

description = """"""

sourceCompatibility = 1.5
targetCompatibility = 1.5

repositories {
     maven { url "http://repo.maven.apache.org/maven2" }
}
dependencies {
    compile group: 'org.slf4j', name: 'slf4j-api', version:'1.7.3' // 부모 POM의 속성을 사용한 의존 관계
    testCompile group: 'junit', name: 'junit', version:'4.0' // 부모 POM의 의존 관계
}
</pre><h3>\chapter14\simple-super-pom\my-project\settings.gradle</h3><pre>rootProject.name = 'my-project'
</pre><h3>\chapter14\testng-pom\build.gradle</h3><pre>  // 변환되는 build.gradle

allprojects  {
  apply plugin: 'maven'

  group = 'com.example'
  version = '0.1-SNAPSHOT'
}

subprojects {
  apply plugin: 'java'
  sourceCompatibility = 1.5
  targetCompatibility = 1.5

  task packageSources(type: Jar) {
    classifier = 'sources'
    from sourceSets.main.allSource
  }
  artifacts.archives packageSources

  repositories {
    mavenLocal()
    maven { url "http://repo.maven.apache.org/maven2" }
  }
  
  dependencies {
    testCompile group: 'org.testng', name: 'testng', version:'6.1.1'
  }
  test.useTestNG()
}

</pre><h3>\chapter14\testng-pom\settings.gradle</h3><pre>rootProject.name = 'simple-parent'
include ':simple-jar'
include ':simple-webapp'

project(':simple-jar').projectDir = "$rootDir/simple-jar" as File
project(':simple-webapp').projectDir = "$rootDir/simple-webapp" as File</pre><h3>\chapter14\testng-pom\simple-jar\build.gradle</h3><pre>
description = 'My multi-mudule simple jar project'
dependencies {
    compile group: 'log4j', name: 'log4j', version:'1.2.14'
    compile group: 'dom4j', name: 'dom4j', version:'1.6.1'
    compile group: 'jaxen', name: 'jaxen', version:'1.1.1'
    compile group: 'velocity', name: 'velocity', version:'1.5'
    testCompile group: 'commons-io', name: 'commons-io', version:'1.3.2'
}

task packageTests(type: Jar) {
  from sourceSets.test.output
  classifier = 'tests'
}
artifacts.archives packageTests
</pre><h3>\chapter14\testng-pom\simple-jar\src\main\resources\log4j.properties</h3><pre># Set root category priority to INFO and its only appender to CONSOLE.
log4j.rootCategory=INFO, CONSOLE

# Set the enterprise logger category to FATAL and its only appender to CONSOLE.
#log4j.logger.org.apache.axis.enterprise=FATAL, CONSOLE

# CONSOLE is set to be a ConsoleAppender using a PatternLayout.
log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender
log4j.appender.CONSOLE.Threshold=INFO
log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout
log4j.appender.CONSOLE.layout.ConversionPattern=%-4r %-5p %c{1} %x - %m%n</pre><h3>\chapter14\testng-pom\simple-webapp\build.gradle</h3><pre>
apply plugin: 'war'

description = 'My multi-module simple web application project'
dependencies {
    compile group: 'org.apache.geronimo.specs', name: 'geronimo-servlet_2.4_spec', version:'1.1.1'
  compile project(':simple-jar')
}
</pre>
  </body>
  </html>
  